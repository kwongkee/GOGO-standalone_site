{include file="common/header"}
<link rel="stylesheet" href="layui/css/layui.css">
<script src="layui/layui.js"></script>
<style type="text/css" media="all">
    #content{padding-top:20px;padding-bottom:20px;}
    .content{padding:0;box-sizing:border-box;}
    .content .col-md-12{padding:0;float:unset;}
    .content .title{font-size:26px;color:{$website['color_word']};font-weight:800;text-align:center;line-height:normal !important;}
    .content .control-group{margin-top:10px;}
    .content .control-group .label_title{width:80px;color:{$website['color_word']};font-weight:800;font-size:15px;text-align:right;margin-right:10px;}
    .content .control-group .controls .form-control{width:90%;font-size:15px;}
    .content .control-group .controls .btn-send{padding:7px 20px;background:{$website['color']};color:{$website['color_word']};border:1px solid {$website['color_word']};}
    .content form{text-align:center;}
    .content form .btn-submit{background:{$website['color']};color:{$website['color_word']};border:1px solid #D2A778;padding:10px 100px;box-sizing:border-box;float:unset !important;margin-top:15px;}
    
    .page_list{margin-top:15px;border:1px solid {$website['color_word']};border-radius:8px;padding:20px 20px;box-sizing:border-box;}
    .page_list .tit{color:{$website['color_word']};font-size:15px;font-weight:800;}
    .page_list .right{margin-left:20px;}
    .page_list .right .abtn{color:{$website['color_word']};font-size:15px;padding:5px 15px;font-weight:800;}
    .page_list .right .btn-sure{background:rgb(19 213 93);margin-bottom:10px;}
    .page_list .right .btn-refuse{background:#ff2222;margin-bottom:0px;}
    
    /**分享**/
    .form-group {
        padding-bottom: 0px;
    }
    .input-group {
        border-collapse: separate;
        display: table;
        position: relative;
        width: 100%;
        display: flex;
        align-items: center;
        color:{$website['color_word']};
        font-size:15px;
        font-weight:800;
    }
    .input-group .name{width:80px;}
    .input-group .input:last-child {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
    .form-group .input-btn{
        width:100%;
        text-align: center;
        padding:7px 15px;
        box-sizing: border-box;
        display: inline-block;
        background:rgb(1,142,215);
        color:#fff;
        border-radius:15px;
        cursor:pointer;
        margin-bottom:10px;
    }
    .form-group .input-btn:hover{background:rgb(186,33,38);}
    .form-big .input, .form-big .button {
        padding: 10px;
        font-size: 15px;
        line-height: 24px;
        height: 46px;
    }
    .input-group .input {
        display: table-cell;
        width: calc(100% - 80px);
        color:#000;
    }
    .input {
        font-size: 14px;
        padding: 6px;
        border: solid 1px #ddd;
        width: 100%;
        height: 34px;
        line-height: 20px;
        display: block;
        border-radius: 4px;
        -webkit-appearance: none;
        /*box-shadow: 0 1px 1px rgb(0 0 0) inset;*/
        transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1) 0s;
    }
    .input-group .addon {
        background-color: {$website['color_word']};
        border: 1px solid #ddd;
        /*border-radius: 4px;*/
        line-height: 1;
        padding: 6px 12px;
        text-align: center;
        width:18%;
        height:46px;
        /*border-top-right-radius: 0;*/
    }
    .padding-big {
        padding: 20px;
    }
    .x3-move {
        /*margin-left: 25%;*/
        display: inline-block;
        /*border-right:1px solid #ccc;*/
    }
    .x6 {
         width: 50%;
    }
    .x1, .x2, .x3, .x4, .x5, .x6, .x7, .x8, .x9, .x10, .x11, .x12 {
        float: left;
    }
    .x1, .x2, .x3, .x4, .x5, .x6, .x7, .x8, .x9, .x10, .x11, .x12, .xl1, .xl2, .xl3, .xl4, .xl5, .xl6, .xl7, .xl8, .xl9, .xl10, .xl11, .xl12, .xs1, .xs2, .xs3, .xs4, .xs5, .xs6, .xs7, .xs8, .xs9, .xs10, .xs11, .xs12, .xm1, .xm2, .xm3, .xm4, .xm5, .xm6, .xm7, .xm8, .xm9, .xm10, .xm11, .xm12, .xb1, .xb2, .xb3, .xb4, .xb5, .xb6, .xb7, .xb8, .xb9, .xb10, .xb11, .xb12 {
        position: relative;
        min-height: 1px;
    }
    .mask{background:black;opacity:0.7;display:none;width:100%;position:fixed;z-index:9999;top:0;left:0;height:100%;}
    .mask_content{display:none;width: 80%;background: white;position: fixed;bottom: 50% !important;left: 50%;z-index: 99999;transform: translate(-50%, 30%);}
    .mask_content input{float: right;width: 100%;line-height: 30px;font-size: 14px;color: #000;border: none;}
    .mask_content .bt{font-size: 16px;color: #000;text-align: center;line-height: 45px;border-bottom: 1px solid #f5f2f2;background: #fff;}
    .mask_content .position{text-align: center;}
    .mask_content .position ul li {overflow: hidden;background: #fff;padding: 2% 4%;border-bottom: 1px solid #f5f2f2;}
    .mask_content .position .p1{width: 80px;text-align:left;float: left;line-height: 30px;font-size: 14px;color: #000;}
    .mask_content #status1{color: #000;margin-bottom: 1rem;margin-top: 1rem;}
    .mask_content #status2{color: #000;margin-bottom: 1.5rem;}
    .mask_content .btn-line{margin-top:80px;width:100%;}
    .mask_content button {color: #444444;background: #F3F3F3;border: 1px #DADADA solid;padding: 5px 10px;border-radius: 2px;font-weight: bold;font-size: 12pt;outline: none;}
    .mask_content .cancel{margin-right:0;background: -webkit-linear-gradient(top, #DD4B39, #D14836);background: -moz-linear-gradient(top, #DD4B39, #D14836);background: -ms-linear-gradient(top, #DD4B39, #D14836);border: 1px solid #DD4B39;color: white;text-shadow: 0 1px 0 #C04131;width:100%;border: 1px solid {$website['color_word']};padding: 10px;margin-top: 10px;}
    .mask_content .submit{color: white;background: #4C8FFB;border: 1px #3079ED solid;box-shadow: inset 0 1px 0 #80B0FB;}
    
    @media screen and (max-width: 768px){
        .x6 {width: 100%;}
        .x3-move {margin-left: 0;border-bottom:1px solid {$website['color_word']};border-right:0;}
        .input-group .addon{width:20%;}
        .box_content{display:flex;align-items:center;justify-content:space-evenly;}
    }
   
    @media (min-width: 1000px){
        .need_service,.need_share,.need_advice{padding:15px 75px;}
        .mask_content{width:350px;}
        .box_content{display:flex;align-items:center;justify-content:space-evenly;}
    }
</style>
<section id="content" class="non_topimg" >
    <div class="container">
        <div class="content" >
            <div class="col-md-12">
                <a href="javascript:history.back(-1);">
                            <div style="display:flex;align-items:center;border: 1px solid #fff;width: fit-content;padding: 10px 20px;border-radius: 15px;background: #8f8b8b;margin-bottom:30px;color:#fff;">
                                <img class="" src="./img/account/back.png" alt="" style="width: 18px;margin-right: 10px;"/>
                                返回
                            </div>
                        </a>
                <div class="title">{if session('lang')=='zh'}下级分销列表{elseif(session('lang')=='cht')}下級分銷列表{elseif(session('lang')=='en')}Subordinate Distribution List{/if}</div>
                {if empty($next_account)}
                    <p style="text-align:center;font-size:20px;color:{$website['color_word']};">——暂无信息——</p>
                {else}
                    {volist name="next_account" id="vo"}
                        <div class="page_list">
                            <div class="disf" style="justify-content:center;">
                                <div class="left">
                                    <div class="tit">下级名称：{if !empty($vo['realname'])}{$vo['realname']}{else}{$vo['nickname']}{/if}</div>
                                    {if !empty($vo['phone'])}
                                        <div class="tit">手机号码：{$vo['phone']}</div>
                                    {else}
                                        <div class="tit">电子邮箱：{$vo['email']}</div>
                                    {/if}
                                    <div class="tit">分销业务：{$vo['agent_content']['category_name']}</div>
                                    <div class="tit">申请时间：{$vo['applytime']}</div>
                                    <div class="tit">审批状态：{$vo['agent_status']}</div>
                                    {if !empty($vo['agent_remark'])}
                                        <div class="tit">拒绝原因：{$vo['agent_remark']}</div>
                                    {/if}
                                </div>
                                {if $vo['agent_status']!='审核通过'}
                                <div class="right">
                                    <div class="btn-sure abtn" onclick="pass({$vo.id},'{$vo['agent_content']['category_name']}',{$vo['type']},{$vo['agent_content']['category']})">通过申请</div>
                                    <div class="btn-refuse abtn" onclick="refuse({$vo.id},'{$vo['agent_content']['category']}')">拒绝申请</div>
                                </div>
                                {/if}
                            </div>
                        </div>
                    {/volist}
                {/if}
            </div>
        </div>
    </div>
</section>

<div class="mask"></div>
<div class="mask_content pass_content" style="background:{$website['color']};border:1px solid {$website['color_word']};">
    <div class="x12 x3-move padding-big" style="width:100%;">
        <form action="" id="passform" class="form-big form-tips" method="post">
            <input type="hidden" name="pass_id" id="pass_id" value="" />
            <div class="pass_append">
                
            </div>
            
            <div class="form-group">
                <div class="field" style="text-align:center;">
                    <input type="submit" class="button x6 x3-move bg-blue text-big" value="{if session('lang')=='zh'}立即提交{elseif(session('lang')=='cht')}立即提交{elseif(session('lang')=='en')}Submit Now{/if}" style="border:1px solid {$website['color_word']};color:{$website['color_word']};float:unset;background:rgb(19 213 93);">
                    <div class="cancel" style="">{if session('lang')=='zh'}关闭{elseif(session('lang')=='cht')}關閉{elseif(session('lang')=='en')}Close{/if}</div>
                </div>
            </div>
        </form>
    </div>
</div>
<div class="mask_content refuse_content" style="background:{$website['color']};border:1px solid {$website['color_word']};">
    <div class="x12 x3-move padding-big" style="width:100%;">
        <form action="" id="refuseform" class="form-big form-tips" method="post">
            <input type="hidden" name="refuse_id" id="refuse_id" value="" />
            <div class="form-group">
                <div class="input-group">
                    <!--<div class="addon" style="height:72px;line-height:55px;"></div>-->
                    <div class="name">拒绝原因</div>
                    <textarea name="contents" id="contents" class="input" placeholder="{if session('lang')=='zh'}请输入拒绝原因{elseif(session('lang')=='cht')}請輸入拒絕原因{elseif(session('lang')=='en')}Please enter the reason for rejection{/if}"></textarea>
                </div>
            </div>
            
            <div class="form-group">
                <div class="field" style="text-align:center;">
                    <input type="submit" class="button x6 x3-move bg-blue text-big" value="{if session('lang')=='zh'}立即提交{elseif(session('lang')=='cht')}立即提交{elseif(session('lang')=='en')}Submit Now{/if}" style="border:1px solid {$website['color_word']};color:{$website['color_word']};float:unset;background:rgb(19 213 93);">
                    <div class="cancel" style="">{if session('lang')=='zh'}关闭{elseif(session('lang')=='cht')}關閉{elseif(session('lang')=='en')}Close{/if}</div>
                </div>
            </div>
        </form>
    </div>
</div>

{include file="common/footer"}
<script type="text/javascript" charset="utf-8">
    $(function(){
        $('#regForm').submit(function(){
            // let json = $('#regForm').serialize();
            
            let number = $('#phone').val();
            if(number==''){
                alert('请输入上级的手机号码');return false;
            }
            
            $.ajax({
                url: "?s=index/apply_distr",
                method: 'post',
                data: {'category':$('#category').val(),'number':number},
                dataType: 'JSON',
                success: function (res) {
                    if(res.code==-1){
                        alert(res.msg);
                        return false;
                    }else{
                        alert(res.msg);
                        setTimeout(function(){
                            window.location.reload();
                        },3000);
                    }
                },
                error: function (data) {
                    
                }
            }); 
            
            return false;
        });
        
        $('.refuse_content .cancel').click(function(){
            $('.mask').fadeOut('slow');
            $('.refuse_content').fadeOut('slow');
        });
        
        $('.pass_content .cancel').click(function(){
            $('.mask').fadeOut('slow');
            $('.pass_content').fadeOut('slow');
        });
        
        $('#passform').submit(function(){
            let trade_amount = $('#trade_amount').val();
            if(trade_amount==''){
                alert('请配置分销佣金');return false;
            }
            $.ajax({
                url: "?s=index/approve_distr",
                method: 'post',
                data: {'typp':$('#typp').val(),'trade_amount':trade_amount,'pass_id':$('#pass_id').val(),'pa':'pass','category':$('#category').val()},
                dataType: 'JSON',
                success: function (res) {
                    if(res.code==-1){
                        alert(res.msg);
                        return false;
                    }else{
                        alert(res.msg);
                        setTimeout(function(){
                            window.location.reload();
                        },3000);
                    }
                },
                error: function (data) {
                    
                }
            }); 
            
            return false;
        });
        
        $('#refuseform').submit(function(){
            let contents = $('#contents').val();
            if(contents==''){
                alert('请输入拒绝原因');return false;
            }
            $.ajax({
                url: "?s=index/approve_distr",
                method: 'post',
                data: {'contents':contents,'refuse_id':$('#refuse_id').val(),'pa':'refuse'},
                dataType: 'JSON',
                success: function (res) {
                    if(res.code==-1){
                        alert(res.msg);
                        return false;
                    }else{
                        alert(res.msg);
                        setTimeout(function(){
                            window.location.reload();
                        },3000);
                    }
                },
                error: function (data) {
                    
                }
            }); 
            
            return false;
        });
    });
    
    function pass(id,buss,typp=1,cate){
        $('#pass_id').val(id);
        $('.mask').fadeIn('slow');
        let html = '<div class="form-group">\n'+
            '<div class="input-group">\n'+
                '<div class="name">分销业务</div>\n'+
                '<div class="desc" style="margin-left:0px;">'+buss+'</div>\n'+
            '</div>\n'+
        '</div>\n'+
        '<input type="hidden" name="typp" id="typp" value="'+typp+'">\n'+
        '<input type="hidden" name="category" id="category" value="'+cate+'">\n';
        if(typp==1){
            html += '<div class="form-group">\n'+
                    '<div class="input-group">\n'+
                        '<div class="name">总金额(%)</div>\n'+
                        '<input type="number" class="input" name="trade_amount" id="trade_amount" placeholder="请输入x%/总金额">\n'+
                    '</div>\n'+
                '</div>\n';    
        }else if(typp==2){
            html += '<div class="form-group">\n'+
                    '<div class="input-group">\n'+
                        '<div class="name">计费重(元)</div>\n'+
                        '<input type="number" class="input" name="trade_amount" id="trade_amount" placeholder="请输入x元/RT">\n'+
                    '</div>\n'+
                '</div>\n';
        }else if(typp==3){
            html += '<div class="form-group">\n'+
                    '<div class="input-group">\n'+
                        '<div class="name">订单(元)</div>\n'+
                        '<input type="number" class="input" name="trade_amount" id="trade_amount" placeholder="请输入x元/票">\n'+
                    '</div>\n'+
                '</div>\n';
        }else if(typp==4){
            html += '<div class="form-group">\n'+
                '<div class="input-group">\n'+
                '<div class="name">总毛利(元)</div>\n'+
                '<input type="number" class="input" name="trade_amount" id="trade_amount" placeholder="请输入订单总毛利的x%">\n'+
                '</div>\n'+
                '</div>\n';
        }
                
        
        
        $('.pass_append').html(html);
        //出现的部分
        $('.pass_content').fadeIn('slow');
        $('.pass_content').css('bottom',0);
    }
    
    function refuse(id){
        $('#refuse_id').val(id);
        $('.mask').fadeIn('slow');
        //出现的部分
        $('.refuse_content').fadeIn('slow');
        $('.refuse_content').css('bottom',0);
    }
</script>
