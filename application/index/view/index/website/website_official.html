{include file="common/header2"}
<link rel="stylesheet" href="layui/css/layui.css">
<style>
    /* 主内容区域 */
    .main-content {padding: 40px 0;min-height: calc(100vh - 200px);}
    .dashboard {margin-top: 30px;}

    /* 侧边栏样式 */
    .sidebar {background: var(--card-bg);border-radius: 20px;padding: 30px;box-shadow: var(--shadow);height: fit-content;}
    .sidebar-title {font-size: 1.5rem;margin-bottom: 25px;color: var(--primary);display: flex;align-items: center;}
    .sidebar-title i {margin-right: 10px;}
    .enterprise-list {list-style: none;margin-bottom: 30px;}
    .enterprise-item {padding: 15px;border-radius: 10px;margin-bottom: 10px;cursor: pointer;transition: all 0.3s ease;border: 2px solid var(--accent);}
    .enterprise-item:hover {background: var(--accent);}
    .enterprise-item.active {background: var(--accent);border-color: var(--primary);}
    .enterprise-name {font-weight: 600;margin-bottom: 5px;}
    .enterprise-desc {font-size: 0.9rem;color: #666;}
    .add-enterprise {display: flex;align-items: center;justify-content: center;padding: 15px;border: 2px dashed var(--primary-light);border-radius: 10px;color: var(--primary);font-weight: 600;cursor: pointer;transition: all 0.3s ease;}
    .add-enterprise:hover {background: var(--accent);border-color: var(--primary);background: var(--accent);border-color: var(--primary);}
    .add-enterprise i {margin-right: 10px;}

    /* 网站管理区域 */
    .website-management {background: var(--card-bg);border-radius: 20px;padding: 30px;box-shadow: var(--shadow);}
    .management-header {display: flex;justify-content: space-between;align-items: center;margin-bottom: 30px;padding-bottom: 20px;border-bottom: 2px solid var(--accent);}
    .management-title {font-size: 1.8rem;color: var(--primary);}
    .site-url {color: var(--primary);font-weight: 500;display: flex;align-items: center;background: var(--accent);padding: 8px 15px;border-radius: 8px;}
    .site-url i {margin-right: 8px;}

    /* 选项卡样式 */
    .tabs {display: flex;margin-bottom: 30px;border-bottom: 2px solid var(--accent);}
    .tab {padding: 12px 25px;cursor: pointer;font-weight: 600;color: var(--text);transition: all 0.3s ease;position: relative;}
    .tab:hover {color: var(--primary);}
    .tab.active {color: var(--primary);}
    .tab.active::after {content: '';position: absolute;bottom: -2px;left: 0;width: 100%;height: 3px;background: var(--gradient);border-radius: 3px;}
    .tab-content {display: none;}
    .tab-content.active {display: block;animation: fadeIn 0.5s ease;}

    /* 表单样式 */
    .form-section {margin-bottom: 30px;}
    .form-title {font-size: 1.3rem;margin-bottom: 20px;color: var(--primary-dark);display: flex;align-items: center}
    .form-title i {margin-right: 10px;}
    .form-grid {display: grid;grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));gap: 20px;}
    .form-group {margin-bottom: 20px;}
    .form-group label {display: block;margin-bottom: 8px;font-weight: 600;color: var(--primary-dark);}
    .form-group input,
    .form-group select,
    .form-group textarea {width: 100%;padding: 15px;border: 2px solid #e0e0e0;border-radius: 10px;font-size: 1rem;transition: border-color 0.3s ease;}
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {border-color: var(--primary);outline: none;}
    .form-group textarea {min-height: 120px;resize: vertical;}
    .form-actions {display: flex;justify-content: flex-end;gap: 15px;margin-top: 30px;padding-top: 20px;border-top: 2px solid var(--accent);}

    /* 频道管理样式 */
    .channel-list {list-style: none;}
    .channel-item {background: var(--background);border-radius: 10px;padding: 20px;margin-bottom: 15px;display: flex;justify-content: space-between;align-items: center;transition: all 0.3s ease;}
    .channel-item:hover {transform: translateX(5px);box-shadow: var(--shadow);}
    .channel-info {flex: 1;}
    .channel-name {font-weight: 600;margin-bottom: 5px;color: var(--primary-dark);}
    .channel-desc {color: #666;font-size: 0.9rem;}
    .channel-actions {display: flex;gap: 10px;}
    .channel-btn {padding: 8px 15px;border-radius: 8px;font-size: 0.9rem;font-weight: 500;cursor: pointer;transition: all 0.3s ease;display: flex;align-items: center;}
    .channel-btn i {margin-right: 5px;}
    .btn{background:var(--primary-light);color: white;border: none;}
    .btn-edit {background: var(--primary-light);color: white;border: none;}
    .btn-edit:hover {background: var(--primary);}
    .btn-delete {background: transparent;color: #ff4757;border: 2px solid #ff4757;}
    .btn-delete:hover {background: #ff4757;color: white;}
    .add-channel {display: flex;align-items: center;justify-content: center;padding: 15px;border: 2px dashed var(--primary-light);border-radius: 10px;color: var(--primary);font-weight: 600;cursor: pointer;transition: all 0.3s ease;margin-top: 20px;}
    .add-channel:hover {background: var(--accent);border-color: var(--primary);}
    .add-channel i {margin-right: 10px;}

    /* 会员管理样式 */
    .member-table {width: 100%;border-collapse: collapse;margin-top: 20px;}
    .layui-table th,
    .layui-table td,
    .member-table th,
    .member-table td {padding: 15px;text-align: left;border-bottom: 1px solid var(--accent);}
    .layui-table th,
    .member-table th {background: var(--accent);color: var(--primary-dark);font-weight: 600;}
    .member-table tr:hover {background: rgba(187, 134, 252, 0.1);}
    .member-status {padding: 5px 10px;border-radius: 20px;font-size: 0.8rem;font-weight: 500;}
    .status-active {background: #2ed573;color: white;}
    .status-inactive {background: #ffa502;color: white;}
    .status-banned {background: #ff4757;color: white;}

    /* 模态框样式 */
    .modal {display: none;position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.5);backdrop-filter: blur(5px);z-index: 2000;align-items: center;justify-content: center;}
    .modal-content {background: white;border-radius: 20px;padding: 30px;width: 60%;/*max-width: 500px;*/box-shadow: var(--shadow-hover);position: relative;}
    .close-modal {position: absolute;top: 20px;right: 20px;font-size: 1.5rem;color: #999;cursor: pointer;transition: color 0.3s ease;}
    .close-modal:hover {color: var(--primary);}
    .modal-title {font-size: 1.5rem;margin-bottom: 20px;color: var(--primary);}
    .form-group {margin-bottom: 20px;}
    .form-group label {display: block;margin-bottom: 8px;font-weight: 600;color: var(--primary-dark);}
    .form-group input,
    .form-group select {width: 100%;padding: 15px;border: 2px solid #e0e0e0;border-radius: 10px;font-size: 1rem;transition: border-color 0.3s ease;border-top-left-radius: 0;border-bottom-left-radius: 0;}
    .form-group input:focus,
    .form-group select:focus {border-color: var(--primary);outline: none;}
    .form-actions {display: flex;justify-content: flex-end;gap: 15px;margin-top: 25px;}

    /*自定义颜色配置*/
    .layui-colorpicker.layui-colorpicker-lg{line-height: 24px;}
    .layui-colorpicker, .layui-colorpicker-trigger-span{border-color:#777;}
    .layui-colorpicker-main-input .layui-btn-container .layui-btn {margin: 0 0 0 5px;}


    /* 动画 */
    @keyframes fadeIn {
        from {opacity: 0;transform: translateY(10px);}
        to {opacity: 1;transform: translateY(0);}
    }

    /* 响应式设计 */
    @media (max-width: 992px) {
        .dashboard {grid-template-columns: 1fr;}
        .sidebar {order: 2;}
        .website-management {order: 1;}
        .nav-links {display: none;}
        .mobile-menu-btn {display: block;}
        .tabs {flex-wrap: wrap;}
        .tab {flex: 1;min-width: 120px;text-align: center;}
        .form-grid {grid-template-columns: 1fr;}
    }

    @media (max-width: 768px) {
        .management-header {flex-direction: column;align-items: flex-start;gap: 15px;}
        .channel-item {flex-direction: column;align-items: flex-start;gap: 15px;}
        .channel-actions {width: 100%;justify-content: flex-end;}
        .member-table {display: block;overflow-x: auto;}
    }

    @media (max-width: 576px) {
        .btn {padding: 10px 20px;font-size: 0.9rem;}
        .logo {font-size: 1.5rem;}
        .form-actions {flex-direction: column;}
    }

    /* 移动菜单按钮 */
    .mobile-menu-btn {display: none;background: none;border: none;font-size: 1.5rem;color: var(--primary);cursor: pointer;}

    @media (max-width: 992px) {
        .mobile-menu-btn {display: block;}
    }
</style>

<!--百度富文本-->
<script type="text/javascript" src="cklein/plugins/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="cklein/plugins/ueditor/ueditor.all.min.js"> </script>
<script type="text/javascript" src="cklein/plugins/ueditor/lang/zh-cn/zh-cn.js"></script>

<!-- 主内容区域 -->
<div class="container main-content">
    <h1>资讯网站管理平台</h1>
    <p>管理您的企业网站配置、页头页脚、网站频道和会员信息</p>

    <div class="dashboard">
        <!-- 侧边栏 - 企业管理 -->
        <div class="sidebar" style="display: none;">
            <h2 class="sidebar-title"><i class="fas fa-building"></i> 我的企业</h2>
            <ul class="enterprise-list">
                {volist name="company" id="vo"}
                <li class="enterprise-item" data-id="{$vo['id']}" onclick="get_enterprise_info({$vo['id']})">
                    <div class="enterprise-name">{$vo['company']}</div>
                    {if !empty($vo['domain_name'])}
                    <div class="enterprise-desc">{$vo['domain_name']}</div>
                    {/if}
                </li>
                {/volist}
            </ul>
            <div class="add-enterprise" id="add-enterprise">
                <i class="fas fa-plus"></i> 添加新企业
            </div>
        </div>

        <!-- 网站管理区域 -->
        <div class="website-management">
            <div class="management-header">
                <h2 class="management-title">企业网站管理</h2>
<!--                <div class="site-url">-->
<!--                    <i class="fas fa-link"></i> website.{$company_info['domain_name2']}.gogo198.net-->
<!--                </div>-->
            </div>

            <!-- 选项卡导航 -->
            <div class="tabs">
                <div class="tab active website-config" data-tab="website-config">网站配置</div>
                <div class="tab header-footer" data-tab="header-footer">页头页脚</div>
                <div class="tab menu" data-tab="menu">网站菜单管理</div>
                <div class="tab carousel" data-tab="carousel">首页轮播图管理</div>
                <div class="tab channels" data-tab="channels">网站频道</div>
                <div class="tab discovery" data-tab="discovery">发现轮播管理</div>
                <div class="tab members" data-tab="members">会员管理</div>
            </div>

            <!-- 网站配置 -->
            <div class="tab-content active" id="website-config">
                <form class="layui-form" action="" method="post" lay-filter="component-form-basic">
                    <input type="hidden" name="company_id" value="{$company_id}">
                    <input type="hidden" name="company_type" value="1">
                    <div class="form-section">
                        <h3 class="form-title"><i class="fas fa-cog"></i> 基本配置</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="siteName">网站名称</label>
                                <input type="text" id="siteName" name="name[zh]" placeholder="请输入网站名称" value="{$website_basic['name']['zh']}">
                            </div>
                            <div class="form-group">
                                <label for="siteDesc">网站描述</label>
                                <input type="text" id="siteDesc" name="desc[zh]" placeholder="请输入网站描述" value="{$website_basic['desc']['zh']}">
                            </div>
                            <div class="form-group">
                                <label for="siteKeywords">网站关键词</label>
                                <input type="text" id="siteKeywords" name="keywords[zh]" placeholder="请输入网站关键词" value="{$website_basic['keywords']['zh']}">
                            </div>
                            <div class="form-group">
                                <label for="logo_file-upload">网站Logo(像素：155*65)</label>
                                <!--                                <input type="file" id="siteLogo" name="logo_file" value="">-->
                                <div class="layui-upload" style="margin-top: 0px;">
                                    <button type="button" class="layui-btn" id="logo_file-upload">上传(一张)</button>
                                    <blockquote class="layui-elem-quote layui-quote-nm yulan" style="margin-top: 10px;">
                                        预览图：
                                        <div class="layui-upload-list" id="logo_file-upload-list">
                                            {if !empty($website_basic['logo'])}
                                            <div style="display: inline-block;">
                                                <img loading="lazy" alt="GOGO198 網站圖片" onclick="seePic(this);" src="{$website_basic['logo']}" class="layui-upload-img" style="width:80px;height:80px;">
                                                <button type="button" onclick="delPic(this);" class="layui-btn layui-btn-xs layui-btn-danger" style="position: relative;left: -45px;top: -39px;">删除</button>
                                                <input type="hidden" name="logo_file[]" value="{$website_basic['logo']}">
                                            </div>
                                            {/if}
                                        </div>
                                    </blockquote>
                                </div>

                            </div>
                            <div class="form-group">
                                <label for="slogo_file-upload">网站图标(像素：200*200)</label>
                                <!--                                <input type="file" id="siteFavicon" name="slogo_file" value="">-->
                                <div class="layui-upload" style="margin-top: 0px;">
                                    <button type="button" class="layui-btn" id="slogo_file-upload">上传(一张)</button>
                                    <blockquote class="layui-elem-quote layui-quote-nm yulan" style="margin-top: 10px;">
                                        预览图：
                                        <div class="layui-upload-list" id="slogo_file-upload-list">
                                            {if !empty($website_basic['slogo'])}
                                            <div style="display: inline-block;">
                                                <img loading="lazy" alt="GOGO198 網站圖片" onclick="seePic(this);" src="{$website_basic['slogo']}" class="layui-upload-img" style="width:80px;height:80px;">
                                                <button type="button" onclick="delPic(this);" class="layui-btn layui-btn-xs layui-btn-danger" style="position: relative;left: -45px;top: -39px;">删除</button>
                                                <input type="hidden" name="slogo_file[]" value="{$website_basic['slogo']}">
                                            </div>
                                            {/if}
                                        </div>
                                    </blockquote>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-title"><i class="fas fa-info-circle"></i> 企业信息</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="mobile">企业电话</label>
                                <input type="text" id="mobile" name="mobile" placeholder="请输入企业电话" value="{$website_basic['mobile']}">
                            </div>
                            <div class="form-group">
                                <label for="companyEmail">企业邮箱</label>
                                <input type="email" id="companyEmail" name="email" placeholder="请输入企业邮箱" value="{$website_basic['email']}">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
    <!--                    <button class="btn btn-outline">取消</button>-->
                        <button class="btn btn-primary" lay-submit lay-filter="component-form-basic">保存配置</button>
                    </div>
                </form>
            </div>

            <!-- 页头页脚 -->
            <div class="tab-content" id="header-footer">
                <form class="layui-form" action="" method="post" lay-filter="component-form-basic2">
                    <input type="hidden" name="company_id" value="{$company_id}">
                    <input type="hidden" name="company_type" value="1">
                    <div class="form-section">
                        <h3 class="form-title"><i class="fas fa-heading"></i> 页头设置</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="color_head">页头背景色</label>
                                <div id="color_head"></div>
                                <input type="hidden" name="color_head" value="{$website_basic['color_head']}">
                            </div>
                            <div class="form-group">
                                <label for="color">网站主题色</label>
                                <div id="color"></div>
                                <input type="hidden" name="color" value="{$website_basic['color']}">
                            </div>
                            <div class="form-group">
                                <label for="color_inner">内页背景色</label>
                                <div id="color_inner"></div>
                                <input type="hidden" name="color_inner" value="{$website_basic['color_inner']}">
                            </div>
                            <div class="form-group">
                                <label for="color_word">网站字体色</label>
                                <div id="color_word"></div>
                                <input type="hidden" name="color_word" value="{$website_basic['color_word']}">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-title"><i class="fas fa-shoe-prints"></i> 页脚设置</h3>
                        <div class="form-group">
                            <label for="copyright_zh">版权信息</label>
                            <script id="copyright_zh" name="copyright_zh" type="text/plain" style="width:100%;height:100px;">
                                {if !empty($website_basic['copyright']['zh'])}
                                    {$website_basic['copyright']['zh']|htmlspecialchars_decode|stripslashes}
                                {/if}
                            </script>
                            <div class="clearfix"></div>
                        </div>
    <!--                    <div class="form-group">-->
    <!--                        <label for="footerLinks">页脚链接</label>-->
    <!--                        <textarea id="footerLinks" placeholder="请输入页脚链接配置（JSON格式）">{"links": ["隐私政策", "使用条款", "网站地图", "帮助中心"]}</textarea>-->
    <!--                    </div>-->
                    </div>

                    <div class="form-actions">
                        <!--                    <button class="btn btn-outline">取消</button>-->
                        <button class="btn btn-primary" lay-submit lay-filter="component-form-basic2">保存配置</button>
                    </div>
                </form>
            </div>

            <!-- 网站菜单管理 -->
            <div class="tab-content" id="menu">
                <h3 class="form-title"><i class="fas fa-certificate"></i> 网站菜单管理</h3>

                <div class="layui-btn-group" style="margin-top: 0px;">
                    <button type="button" class="btn btn-default" onclick="save(2);" style="font-size:15px;">
                        <i class="fas fa-add"></i>
                        添加一级菜单
                    </button>
                </div>

                <table id="auth-table" class="layui-table" lay-filter="auth-table" style="border-color:#000;"></table>

                <!-- 操作列 -->
                <script type="text/html" id="auth-state">
                    <div class="" style="text-align: left;width:100%;">
                        <a class="layui-btn layui-btn-xs btn-add" lay-event="add" onclick="addMenu('{{d.id}}');"><i class="fas fa-add"></i> 添加</a>
                        <a class="layui-btn layui-btn-xs btn-edit" lay-event="edit" onclick="editMenu('{{d.id}}');"><i class="fas fa-edit"></i> 编辑</a>
                        <a class="layui-btn layui-btn-xs btn-delete" lay-event="del" onclick="delMenu('{{d.id}}')"><i class="fas fa-trash"></i> 删除</a>
                    </div>
                </script>
            </div>

            <!-- 首页轮播图管理 -->
            <div class="tab-content" id="carousel">
                <h3 class="form-title"><i class="fas fa-images"></i> 轮播图管理</h3>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content">
                                <div id="toolbar" class="btn-group" style="margin-top: 10px;margin-bottom: 10px;line-height: 34px;">
                                    <button type="button" onclick="save(1);" class="btn btn-default">
                                        <i class="fas fa-add"></i>
                                        添加轮播图
                                    </button>
                                </div>
                                <table id="table" class="layui-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>轮播图名称</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {if empty($rotate)}
                                        <tr>
                                            <td colspan="3" style="text-align:center;">--暂无信息--</td>
                                        </tr>
                                    {else}
                                        {volist name="rotate" id="vo"}
                                            <tr>
                                                <td>{$vo['id']}</td>
                                                <td>{$vo['title']}</td>
                                                <td>
                                                    <div class="channel-actions">
                                                        <button class="channel-btn btn-edit" onclick="edit_rotate({$vo['id']},'{$vo['title']}')"><i class="fas fa-edit"></i> 编辑</button>
                                                        <button class="channel-btn btn-delete" onclick="del_rotate({$vo['id']},'{$vo['title']}')"><i class="fas fa-trash"></i> 删除</button>
                                                    </div>
                                                </td>
                                            </tr>
                                        {/volist}
                                    {/if}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 网站频道 -->
            <div class="tab-content" id="channels">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-layer-group"></i> 网站频道管理</h3>

                    <ul class="channel-list">
                        {if empty($website_index)}
                            <div style="font-size:15px;text-align: center;">--暂无信息--</div>
                        {else}
                            {volist name="website_index" id="vo"}
                                <li class="channel-item">
                                    <div class="channel-info">
                                        <div class="channel-name">{$vo['name']}</div>
                                        <div class="channel-desc">排序：{$vo['displayorder']}</div>
                                    </div>
                                    <div class="channel-actions">
                                        <button class="channel-btn btn-edit" onclick="edit_index({$vo['id']})"><i class="fas fa-edit"></i> 编辑</button>
                                        <button class="channel-btn btn-delete" onclick="del_index({$vo['id']})"><i class="fas fa-trash"></i> 删除</button>
                                    </div>
                                </li>
                            {/volist}
                        {/if}
                    </ul>

                    <div class="add-channel" onclick="save(3)">
                        <i class="fas fa-plus"></i> 添加新频道
                    </div>
                </div>
            </div>

            <!-- 发现轮播管理 -->
            <div class="tab-content" id="discovery">
                <h3 class="form-title"><i class="fas fa-images"></i> 发现轮播管理</h3>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content">
                                <div id="toolbar" class="btn-group" style="margin-top: 10px;margin-bottom: 10px;line-height: 34px;">
                                    <button type="button" onclick="save(4);" class="btn btn-default">
                                        <i class="fas fa-add"></i>
                                        添加发现轮播图
                                    </button>
                                </div>
                                <table id="table" class="layui-table">
                                    <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>描述</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {if empty($website_discovery)}
                                    <tr>
                                        <td colspan="4" style="text-align:center;">--暂无信息--</td>
                                    </tr>
                                    {else}
                                    {volist name="website_discovery" id="vo"}
                                    <tr>
                                        <td>{$vo['id']}</td>
                                        <td>{$vo['descs']}</td>
                                        <td>{$vo['createtime']}</td>
                                        <td>
                                            <div class="channel-actions">
                                                <button class="channel-btn btn-edit" onclick="edit_discovery({$vo['id']})"><i class="fas fa-edit"></i> 编辑</button>
                                                <button class="channel-btn btn-delete" onclick="del_discovery({$vo['id']})"><i class="fas fa-trash"></i> 删除</button>
                                            </div>
                                        </td>
                                    </tr>
                                    {/volist}
                                    {/if}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 会员管理 -->
            <div class="tab-content" id="members">
                <div class="form-section">
                    <h3 class="form-title"><i class="fas fa-users"></i> 会员管理</h3>

                    <table class="layui-hide" id="memberTable"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 添加轮播图·模态框 -->
<div class="modal" id="saveRotateModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 class="modal-title">保存轮播图</h2>
        <iframe src="" class="rotate_iframe" frameborder="0" style="width: 100%;height:600px;"></iframe>
    </div>
</div>

<!-- 添加菜单·模态框 -->
<div class="modal" id="saveMenuModal">
    <div class="modal-content" style="/*min-height:800px;*/overflow-y:auto;">
        <span class="close-modal close-modal-menu">&times;</span>
        <h2 class="modal-title">保存菜单</h2>
        <iframe src="" class="menu_iframe" frameborder="0" style="width: 100%;height:600px;"></iframe>
    </div>
</div>

<!-- 添加首页频道·模态框 -->
<div class="modal" id="saveIndexModal">
    <div class="modal-content" style="/*min-width:800px;min-height:800px;*/overflow-y:auto;">
        <span class="close-modal close-modal-index">&times;</span>
        <h2 class="modal-title">保存频道</h2>
        <iframe src="" class="index_iframe" frameborder="0" style="width: 100%;height:600px;"></iframe>
    </div>
</div>

<!-- 添加发现轮播·模态框 -->
<div class="modal" id="saveDiscoveryModal">
    <div class="modal-content">
        <span class="close-modal close-modal-discovery">&times;</span>
        <h2 class="modal-title">保存信息</h2>
        <iframe src="" class="discovery_iframe" frameborder="0" style="width: 100%;height:600px;"></iframe>
    </div>
</div>

<script src="js/jquery-3.6.0.min.js"></script>
<script src="layui/layui.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 选项卡切换
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');

                // 移除所有active类
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(tc => tc.classList.remove('active'));

                // 添加active类到当前选项卡和内容
                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // 移动菜单切换
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navLinks = document.querySelector('.nav-links');

        mobileMenuBtn.addEventListener('click', function() {
            navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
        });

        // 企业选择
        const enterpriseItems = document.querySelectorAll('.enterprise-item');
        enterpriseItems.forEach(item => {
            item.addEventListener('click', function() {
                enterpriseItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // 新增企业
        // document.getElementById('add-enterprise').addEventListener('click', function() {
        //     window.open('https://boss.gogo198.cn/?s=members/member_center&mid=$mid&first_idx=10&second_idx=13', '_blank');
        // });

        //轮播图弹窗关闭事件===start
        const modal = document.getElementById('saveRotateModal');
        const closeBtn = document.querySelector('.close-modal');
        // const cancelBtn = document.getElementById('cancelBtn');
        // 关闭模态框
        function closeModal() {
            modal.style.display = 'none';
        }
        closeBtn.addEventListener('click', closeModal);
        // cancelBtn.addEventListener('click', closeModal);
        //轮播图弹窗关闭事件===end

        //频道弹窗关闭事件===start
        const index_modal = document.getElementById('saveIndexModal');
        const index_closeBtn = document.querySelector('.close-modal-index');
        // 关闭模态框
        function closeModalIndex() {
            index_modal.style.display = 'none';
        }
        index_closeBtn.addEventListener('click', closeModalIndex);
        //频道弹窗关闭事件===end

        //发现轮播弹窗关闭事件===start
        const discovery_modal = document.getElementById('saveDiscoveryModal');
        const discovery_closeBtn = document.querySelector('.close-modal-discovery');
        // 关闭模态框
        function closeModalDiscovery() {
            discovery_modal.style.display = 'none';
        }
        discovery_closeBtn.addEventListener('click', closeModalDiscovery);
        //频道弹窗关闭事件===end

        //菜单弹窗关闭事件===start
        const menu_modal = document.getElementById('saveMenuModal');
        const menu_closeBtn = document.querySelector('.close-modal-menu');

        // 关闭模态框
        function closeModalMenu() {
            menu_modal.style.display = 'none';
        }
        menu_closeBtn.addEventListener('click', closeModalMenu);
        // 点击模态框外部关闭
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                closeModal();
            }

            if (event.target === menu_modal) {
                closeModalMenu();
            }

            if (event.target === index_modal) {
                closeModalIndex();
            }

            if (event.target === discovery_modal) {
                closeModalDiscovery();
            }
        });
        //菜单弹窗关闭事件===end
    });

    var table;

    layui.config({
        base: '/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index', //主入口模块
        treetable: 'treetable-lay/treetable'
    }).use(['index', 'form','upload', 'colorpicker','treetable','table'], function() {
        var $ = layui.$
            , admin = layui.admin
            , element = layui.element
            , layer = layui.layer
            , form = layui.form
            , colorpicker = layui.colorpicker
            , upload = layui.upload
            , table = layui.table
            , treetable = layui.treetable;

        //页面跳转进来跳转到指定tab框
        $(".{$tab}").click();

        //网站配置=================start
        //网站标志图片
        upload.render({
            elem: '#slogo_file-upload'
            ,url: '/?s=index/upload_file'
            ,accept: 'image'
            ,data: { folder: 'merch_file', type: 'website_index'}
            ,multiple: false
            ,number:1
            ,before: function(obj){
                layer.load(); //上传loading
            }
            ,done: function(res){
                layer.closeAll('loading'); //关闭loading
                if(res.error == 1)
                {

                    $('#slogo_file-upload-list').append('<div style="display: inline-block;"><img loading="lazy" alt="GOGO198 網站圖片" onclick="seePic(this);" src="'+ res.file_path +'" class="layui-upload-img" style="width:80px;height:80px;"><button type="button" onclick="delPic(this);" class="layui-btn layui-btn-xs layui-btn-danger" style="position: relative;left: -45px;top: -39px;">删除</button><input type="hidden" name="slogo_file[]" value="'+res.file_path+'"></div>')
                }
            }
        });

        // 网站Logo图片
        upload.render({
            elem: '#logo_file-upload'
            ,url: '/?s=index/upload_file'
            ,accept: 'image'
            ,data: { folder: 'merch_file', type: 'website_index'}
            ,multiple: false
            ,number:1
            ,before: function(obj){
                layer.load(); //上传loading
            }
            ,done: function(res){
                layer.closeAll('loading'); //关闭loading
                if(res.error == 1)
                {

                    $('#logo_file-upload-list').append('<div style="display: inline-block;"><img loading="lazy" alt="GOGO198 網站圖片" onclick="seePic(this);" src="'+ res.file_path +'" class="layui-upload-img" style="width:80px;height:80px;"><button type="button" onclick="delPic(this);" class="layui-btn layui-btn-xs layui-btn-danger" style="position: relative;left: -45px;top: -39px;">删除</button><input type="hidden" name="logo_file[]" value="'+res.file_path+'"></div>')
                }
            }
        });

        //网站配置提交
        form.on('submit(component-form-basic)', function(data){
            layer.load();
            $.ajax({
                url:"/?s=index/save_website_basic",
                method:'post',
                data:data.field,
                dataType:'JSON',
                success:function(res){
                    layer.closeAll('loading');
                    layer.msg(res.msg,{time:2000}, function () {
                        if(res.code == 0)
                        {
                            window.location.reload();
                        }
                    });
                },
                error:function (data) {
                    layer.msg('系统错误',{time:2000});
                }
            });
            return false;
        });
        //网站配置=================end

        //页头页脚=================start
        //页头背景色
        {if !empty($website_basic['color_head'])}
            colorpicker.render({
                elem:'#color_head',
                alpha:true,
                size:'lg',
                predefine:true,
                color:'{$website_basic["color_head"]}',
                done:function(color){
                    $('input[name="color_head"]').val(color);
                }
            });
        {else}
            colorpicker.render({
                elem:'#color_head',
                alpha:true,
                size:'lg',
                done:function(color){
                    $('input[name="color_head"]').val(color);
                }
            });
        {/if}

        //网站主题色
        {if !empty($website_basic['color_head'])}
            colorpicker.render({
                elem:'#color',
                alpha:true,
                size:'lg',
                predefine:true,
                color:'{$website_basic["color"]}',
                done:function(color){
                    $('input[name="color"]').val(color);
                }
            });
        {else}
            colorpicker.render({
                elem:'#color',
                alpha:true,
                size:'lg',
                done:function(color){
                    $('input[name="color"]').val(color);
                }
            });
        {/if}

        //内页背景色
        {if !empty($website_basic['color_inner'])}
            colorpicker.render({
                elem:'#color_inner',
                alpha:true,
                size:'lg',
                predefine:true,
                color:'{$website_basic["color_inner"]}',
                done:function(color){
                    $('input[name="color_inner"]').val(color);
                }
            });
        {else}
            colorpicker.render({
                elem:'#color_inner',
                alpha:true,
                size:'lg',
                done:function(color){
                    $('input[name="color_inner"]').val(color);
                }
            });
        {/if}

        //网站字体颜色
        {if !empty($website_basic['color_word'])}
            colorpicker.render({
                elem:'#color_word',
                alpha:true,
                size:'lg',
                predefine:true,
                color:'{$website_basic["color_word"]}',
                done:function(color){
                    $('input[name="color_word"]').val(color);
                }
            });
        {else}
            colorpicker.render({
                elem:'#color_word',
                alpha:true,
                size:'lg',
                done:function(color){
                    $('input[name="color_word"]').val(color);
                }
            });
        {/if}

        //版权信息
        UE.getEditor('copyright_zh', {
            initialFrameHeight: 200,
            serverUrl: 'cklein/plugins/ueditor/php/controller.php',
        });
        setTimeout(function(){
            $('.edui-editor-iframeholder iframe').css('background','#666');
            $('#edui1').find('body').css('background','#666');
        },3000);

        //页头页脚提交
        form.on('submit(component-form-basic2)', function(data){
            layer.load();
            $.ajax({
                url:"/?s=index/save_website_basic2",
                method:'post',
                data:data.field,
                dataType:'JSON',
                success:function(res){
                    layer.closeAll('loading');
                    layer.msg(res.msg,{time:2000}, function () {
                        if(res.code == 0)
                        {
                            let currentUrl = new URL(window.location.href);
                            currentUrl.searchParams.set('tab', 'header-footer');
                            window.history.pushState({}, '', currentUrl.toString());

                            window.location.reload();
                        }
                    });
                },
                error:function (data) {
                    layer.msg('系统错误',{time:2000});
                }
            });
            return false;
        });
        //页头页脚=================end

        //网站菜单=================start
        // 渲染表格
        layer.load(2);
        treetable.render({
            treeColIndex: 1,
            treeSpid: 0,
            treeIdName: 'id',
            treePidName: 'pid',
            elem: '#auth-table',
            url: '/?s=index/menu_manage&company_id={$company_id}&company_type=1',
            page: true,
            treeDefaultClose:false,
            cols: [[
                {type: 'numbers'},
                {field: 'name',width:200, title: '名称'},
                {templet: '#auth-state', align: 'center', title: '操作'}
            ]],
            done: function () {
                layer.closeAll('loading');
            }
        });
        //网站菜单=================end

        //轮播图=================start
        //轮播图跳转方式
        $('#go_other').change(function(){
            if($(this).val()==1){
                $('.other_link').show();
            }else{
                $('.other_link').hide();
            }
        });

        //轮播图提交
        form.on('submit(component-form-rotate)', function(data){
            layer.load();
            $.ajax({
                url:"/?s=index/save_website_rotate",
                method:'post',
                data:data.field,
                dataType:'JSON',
                success:function(res){
                    layer.closeAll('loading');
                    layer.msg(res.msg,{time:2000}, function () {
                        if(res.code == 0)
                        {
                            let currentUrl = new URL(window.location.href);
                            currentUrl.searchParams.set('tab', 'carousel');
                            window.history.pushState({}, '', currentUrl.toString());

                            window.location.reload();
                        }
                    });
                },
                error:function (data) {
                    layer.msg('系统错误',{time:2000});
                }
            });
            return false;
        });
        //轮播图=================end

        //会员管理=================end
        table.render({
            elem: '#memberTable'
            ,url: "/?s=index/member_manage&pa=1&company_type=1&company_id={$company_id}"
            ,cellMinWidth: 200
            ,cols: [[
                {field:'realname', width:200, title: '买家名称'}
                ,{field:'nickname', width:200, title: '买家昵称'}
                ,{field:'email', width:200, title: '邮箱地址'}
                ,{field:'phone', width:200, title: '手机号码'}
                ,{field:'createtime', width:200, title: '创建时间'}
                ,{align:'center', fixed: 'right', title: '操作', templet: function(d){
                        var result = "";

                        result += '<a onclick="save_member(1,' + "'/?s=index/save_member&company_type=1&company_id={$company_id}&id="+ d.id + '\');" class="layui-btn layui-btn-xs btn-edit btn"><i class="fas fa-edit"></i> 编辑</a>';
                        // result += '<a onclick="del('+ "'"+d.id+"'" +',1);" class="layui-btn layui-btn-xs btn-delete btn"><i class="fas fa-trash"></i> 删除</a>';

                        return [
                            result
                        ].join('');

                        return result;
                    }}
            ]]
            ,page: true
        });
        //会员管理=================end


    });

    //轮播图编辑
    function edit_rotate(id,name=''){
        var modal = document.getElementById('saveRotateModal');
        modal.style.display = 'flex';

        $('#saveRotateModal .rotate_iframe').attr('src','/?s=index/save_website_rotate&company_id={$company_id}&company_type=1&id='+id);
    }

    //轮播图删除
    function del_rotate(id,name=''){
        var layer = layui.layer,$ = layui.$;
        layer.confirm('确认要删除该轮播图？', {
            btn: ['删除','取消']
        }, function(){
            $.ajax({
                url:"/?s=index/del_website_rotate",
                type:"GET",
                dataType:"json",
                data:{id:id},
                success:function (res) {
                    layer.msg(res.msg);
                    if (res.code==0){
                        setTimeout(function () {
                            window.location.reload();
                        },2000);
                    }
                },
                error:function (xhr) {
                    layer.msg('连接服务器错误！');
                }
            });
            layer.closeAll();
        }, function(){

        });
    }

    //添加轮播图&菜单&网站频道&发现轮播
    function save(type) {
        if(type==1){
            //轮播图
            var modal = document.getElementById('saveRotateModal');
            modal.style.display = 'flex';

            $('#saveRotateModal .rotate_iframe').attr('src','/?s=index/save_website_rotate&company_id={$company_id}&company_type=1');
        }
        else if(type==2){
            //菜单
            var modal = document.getElementById('saveMenuModal');
            modal.style.display = 'flex';

            $('#saveMenuModal .menu_iframe').attr('src','/?s=index/save_website_menu&company_id={$company_id}&company_type=1');
        }
        else if(type==3){
            //网站频道
            var modal = document.getElementById('saveIndexModal');
            modal.style.display = 'flex';

            $('#saveIndexModal .index_iframe').attr('src','/?s=index/save_website_index&company_id={$company_id}&company_type=1');
        }
        else if(type==4){
            //发现轮播
            var modal = document.getElementById('saveDiscoveryModal');
            modal.style.display = 'flex';

            $('#saveDiscoveryModal .discovery_iframe').attr('src','/?s=index/save_website_discovery&company_id={$company_id}&company_type=1');
        }
    }

    function save_member(type,url) {
        if(type==1){
            //轮播图
            var modal = document.getElementById('saveDiscoveryModal');
            modal.style.display = 'flex';

            $('#saveDiscoveryModal .discovery_iframe').attr('src',url);
        }
    }

    //网站频道编辑
    function edit_index(id){
        var modal = document.getElementById('saveIndexModal');
        modal.style.display = 'flex';

        $('#saveIndexModal .index_iframe').attr('src','/?s=index/save_website_index&company_id={$company_id}&company_type=1&id='+id);
    }

    //网站频道删除
    function del_index(id){
        var layer = layui.layer,$ = layui.$;
        layer.confirm('确认要删除该频道？', {
            btn: ['删除','取消']
        }, function(){
            $.ajax({
                url:"/?s=index/del_website_index",
                type:"GET",
                dataType:"json",
                data:{id:id},
                success:function (res) {
                    layer.msg(res.msg);
                    if (res.code==0){
                        setTimeout(function () {
                            window.location.reload();
                        },2000);
                    }
                },
                error:function (xhr) {
                    layer.msg('连接服务器错误！');
                }
            });
            layer.closeAll();
        }, function(){

        });
    }

    //发现轮播图编辑
    function edit_discovery(id){
        var modal = document.getElementById('saveDiscoveryModal');
        modal.style.display = 'flex';

        $('#saveDiscoveryModal .discovery_iframe').attr('src','/?s=index/save_website_discovery&company_id={$company_id}&company_type=1&id='+id);
    }

    //发现轮播图删除
    function del_discovery(id,name=''){
        var layer = layui.layer,$ = layui.$;
        layer.confirm('确认要删除该发现轮播图？', {
            btn: ['删除','取消']
        }, function(){
            $.ajax({
                url:"/?s=index/del_website_discovery",
                type:"GET",
                dataType:"json",
                data:{id:id},
                success:function (res) {
                    layer.msg(res.msg);
                    if (res.code==0){
                        setTimeout(function () {
                            window.location.reload();
                        },2000);
                    }
                },
                error:function (xhr) {
                    layer.msg('连接服务器错误！');
                }
            });
            layer.closeAll();
        }, function(){

        });
    }

    //添加下级菜单
    function addMenu(pid=0) {
        var modal = document.getElementById('saveMenuModal');
        modal.style.display = 'flex';

        $('#saveMenuModal .menu_iframe').attr('src','/?s=index/save_website_menu&company_id={$company_id}&company_type=1&pid='+pid);
    }

    //编辑菜单
    function editMenu(id=0) {
        var modal = document.getElementById('saveMenuModal');
        modal.style.display = 'flex';

        $('#saveMenuModal .menu_iframe').attr('src','/?s=index/save_website_menu&company_id={$company_id}&company_type=1&id='+id);
    }

    //删除菜单
    function delMenu(id) {
        var layer = layui.layer,$ = layui.$;
        layer.confirm('确认要删除该菜单？', {
            btn: ['删除','取消']
        }, function(){
            $.ajax({
                url:"/?s=index/del_website_menu",
                type:"GET",
                dataType:"json",
                data:{id:id},
                success:function (res) {
                    layer.msg(res.msg);
                    if (res.code==0){
                        setTimeout(function () {
                            location.reload();
                        },2000);
                    }
                },
                error:function (xhr) {
                    layer.msg('连接服务器错误！');
                }
            });
        }, function(){

        });
    }

    function delPic(obj)
    {
        var layer = layui.layer,$ = layui.$;
        layer.confirm('确认要删除该附件？', {
            btn: ['删除','取消']
        }, function(){
            $(obj).parent().remove();
            layer.closeAll();
        }, function(){

        });
    }
</script>

{include file="common/footer2"}