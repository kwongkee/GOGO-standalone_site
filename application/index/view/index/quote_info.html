{include file="common/header"}
<link rel="stylesheet" href="layui/css/layui.css">
<script src="layui/layui.js"></script>
<style type="text/css" media="all">
    #content{padding-top:20px;padding-bottom:20px;background:{$website['color_inner']};}
    .content{padding:20px 20px;box-sizing:border-box;}
    .content .col-md-12{padding:0;float:unset;}
    .content .box_content{justify-content:center;border-radius:8px;margin-bottom:30px;}
    .content .box_content{background:{$website['color']};color:{$website['color_word']};border:1px solid {$website['color_word']};font-size:25px;text-align:center;padding:30px;width:100%;}
    .content .box_content img{width:40px;margin-right:5px;}
    .layui-elem-field legend,.layui-form-item .layui-form-label{color:{$website['color_word']};}
    .word_color{color:{$website['color_word']};}
    .layui-card{background:{$website['color_inner']};}
    .layui-fluid,.layui-card-body{padding:0;}

    .layui-form-label{width:100px;}
    .layui-input-block{line-height:38px;}
    legend{width:unset;border-bottom:0;}
    .ordertype2,.type1_h,.type1,.type2,.create_user,.type2_h,.type3,.sms{display:none;}
    .back_btn{display:flex;align-items:center;border: 1px solid #fff;width: fit-content;padding: 10px 20px;border-radius: 15px;background: #8f8b8b;margin-bottom:15px;color:#fff;}
    .main_template{padding:0 0px;}
    .main_template .layui-input-block{line-height: 24px !important;margin-left:90px;color:{$website['color_word']};}
    .main_template .layui-form-label{width:80px;color:#000;}
    /**数量增减框样式**/
    .quantity {display: flex;align-items: center;}
    .quantity input[type="number"] {width: 100%;text-align: center;}
    .quantity button {background-color: transparent;cursor: pointer;font-size: 20px;padding: 0 5px;border: 1px solid #e6e6e6;height: 38px;width: 50px;}
    /*.layui-form-select{width:150px;}*/
    .right{text-align: right;}
    .layui-elem-field{margin-bottom: 0;}
    /**聊天模板**/
    #edui1_iframeholder{height:150px !important;}
    .conatact_info{padding:10px;box-sizing: border-box;}
    .chat_content{border:1px solid #eee;height:300px;margin-bottom:5px;overflow-y:scroll;background:rgb(240,230,221);}
    .chat_content .center{width: fit-content;margin: 0 auto;padding: 5px 20px;box-sizing: border-box;background: unset;border-radius: 8px;margin-top: 10px;font-weight:bolder;}
    .conatact_info .right{float:right;margin-top:5px;}
    .conatact_info .left{float:left;margin-top:5px;}
    .conatact_info .disflex{display:flex;align-items:center;max-width:80%;}
    /**右**/
    .conatact_info .right .my_txt{background:rgb(230,254,218);color:#000;font-size:15px;padding:10px 15px;padding-right:70px;box-sizing: border-box;border-radius: 10px;border-top-right-radius:5px;margin-right:15px;box-shadow:0px 0px 10px 2px #efeded;position:relative;}
    /*calc(50% - 10px)*/
    .conatact_info .right .my_txt::after{content: '';width: 0;height: 0;border-top: 10px solid transparent;border-left: 10px solid rgb(230,254,218);border-bottom: 10px solid transparent;position: absolute;right: -8px;top: 0;}
    .conatact_info .right .my_txt .time_info{position:absolute;bottom:0;right:6px;}
    .conatact_info .right .my_txt .time_info .time{font-size:12px;font-weight:bold;color:#666;margin-right: 8px;}
    /**左**/
    .conatact_info .left .my_txt{background:#efefef;color:#000;font-size:15px;padding:10px 15px;padding-left:50px;box-sizing: border-box;border-radius: 10px;border-top-left-radius:5px;margin-left:15px;box-shadow:0px 0px 10px 2px #efeded;position: relative;}
    .conatact_info .left .my_txt::after{width: 0;height: 0;border-top: 10px solid transparent;border-right: 10px solid #efefef;border-bottom: 10px solid transparent;content: '';position: absolute;left: -10px;top: 0;}
    .conatact_info .left .my_txt .time_info{position:absolute;bottom:0;left:8px;}
    .conatact_info .left .my_txt .time_info .time{font-size:12px;font-weight:bold;color:#666;margin-right: 8px;}
    .conatact_info .my_ava img{width:30px;height:30px;}
    .edui-editor-iframeholder iframe {background: #444444;}
    /**对号样式**/
    .check-style-unequal-width {width: 5px;height: 10px;border-color: #1790FF;border-style: solid;border-width: 0 3px 3px 0;transform: rotate(35deg);}
    .check-style-unequal-width-1 {width: 5px;height: 10px;border-color: #666;border-style: solid;border-width: 0 3px 3px 0;transform: rotate(35deg);}
    .check-style-unequal-width2 {width: 5px;height: 10px;border-color: #1790FF;border-style: solid;border-width: 0 3px 3px 0;transform: rotate(35deg);}
    .check-style-unequal-width2-1 {width: 5px;height: 10px;border-color: #666;border-style: solid;border-width: 0 3px 3px 0;transform: rotate(35deg);}
    /**聊天样式结束**/
    /**报价模板**/
    .input80{width:80%;}
    .input50{width:50%;}
    .input31{width:36.5%;}
    .input30{width:30%;}
    .input20{width:20%;}
    .input15{width:15%;}
    .marbtm10{margin-bottom:0px;}
    .disf_legend{width: 38%;padding-right: 0 !important;margin-right: 0 !important;padding-left: 0;}
    .template_namebox{margin-left: 21px;}
    .template_remark{width:94.5%;}
    .fake_input{line-height: 38px;overflow: hidden;}
    .this_textarea{display: none;padding:10px;box-sizing: border-box;text-align: center;}
    .template_name{border: 1px solid #fff;padding-left: 0;padding-right: 0;width: 100px;margin-left: 20px;margin-right: 10px;text-align: center;}
    .template_remark{color:#000;}
    .addBox{margin-bottom:10px;}
    .edit_png{width:20px;height:20px;}
    .template_box{margin-bottom:0;}
    .template_box .layui-form-select .layui-input,.template_box .layui-input, .layui-textarea{color:#000;}
    .quote_box .main_template .layui-form-label{width:100px;color:#000;}
    .quote_box .main_template .layui-input-block{margin-left: 110px;}
    .quote_box .layui-form-select{color:#000;}
    .quote_box .label_select{color:{$website['color_word']} !important;}
    .quote_box,.template_box{padding:10px;}
    /**报价模板结束**/
    @media (max-width:992px){
        .container_content{margin-top:15px;}
        /**日期时间**/
        .layui-laydate-range{left: 0 !important;width: fit-content;}
        .layui-laydate-range .layui-laydate-main{display: block;width: 100%;}
        .layui-laydate-range .layui-laydate-main .layui-laydate-content table{width: 100%;}
        .date_type{display: inline-block;}
        .common50,.date_box{width:100%;}
        .baojia{align-items: flex-start;}
        .country_type,.value_type{width:100%;}
        .disf_legend{width:fit-content !important;max-width: 90% !important;}
        .template_remark{width: 100%;}
        .layui-fluid,.layui-card-body{padding:0;}
        .label_select{width:60px;}
        .label_block{margin-left:70px;}
        .back_btn{margin-top:15px;}
        /**日期时间**/
        .layui-laydate-range{left: 0 !important;width: fit-content;}
        .layui-laydate-range .layui-laydate-main{display: block;width: 100%;}
        .layui-laydate-range .layui-laydate-main .layui-laydate-content table{width: 100%;}
        /**报价模板**/
        .input31{width: 95%;}
        .input30{width: 100%;}
        .input20{width: 56%;}
        .input15{width: 50%;}
        .container_content{margin-top:15px;}
        .date_type{display: inline-block;}
        .common50,.date_box{width:100%;}
        .baojia{align-items: flex-start;}
        .country_type,.value_type{width:100%;}
        /*.disf_legend{width: 90% !important;}*/
        .template_remark{width: 100%;}
        /**报价模板结束**/
    }
    .xm-select-demo .xm-label{overflow: hidden;}
    .xm-select-demo .xm-label-block{white-space: nowrap;}
    /**询报价详情样式**/
    .table_diy{border-collapse: collapse;width: 100%;}
    .table_diy td,.table_diy th{border: 1px solid #fff;width: 100px;text-align: center;}
</style>
<!--百度富文本-->
<script type="text/javascript" src="/cklein/plugins/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/cklein/plugins/ueditor/ueditor.all.min.js"> </script>
<script type="text/javascript" src="/cklein/plugins/ueditor/lang/zh-cn/zh-cn.js"></script>
<section id="content" class="non_topimg">
    <div class="container">
        <div class="content" style="padding:0;">
            <div class="layui-fluid">
                <div class="layui-row layui-col-space15">
                    <form class="layui-form" action="" method="post" lay-filter="component-form-element">
                        <input type="text" name="id" id="id" value="{$id}" style="display:none;"/>
                        <div class="layui-col-md12">
                            <a href="javascript:history.back(-1);">
                                <div class="back_btn">
                                    <img class="" src="./img/account/back.png" alt="" style="width: 18px;margin-right: 10px;"/>
                                    返回
                                </div>
                            </a>
                            <div class="layui-card">
                                <div class="layui-card-body">
                                    <fieldset class="layui-elem-field template_box">
                                        <legend>
                                            {if(isset($data['inquiry_user']['custom_id']))}
                                            询价买家[{$data['inquiry_user']['custom_id']}]的[{$data['buss_name']}]业务询价单
                                            {else}
                                            [{$data['buss_name']}]业务询价单
                                            {/if}
                                        </legend>
                                        <div class="layui-field-box" style="padding:0;">
                                            {if !empty($data['content'])}
                                                {if $data['is_quote']==1}
                                                    <!--复制报价表单的，由B端创建无询价报价订单-->
                                                    {volist name="data['content']" key="key" id="vo"}
                                                    <div class="main_template">
                                                        <fieldset class="layui-elem-field quote_box">
                                                            <legend class="disf disf_legend">{$vo['project_name']}</legend>
                                                            <div class="layui-field-box" style="padding:0 0px;">
                                                                <div class="layui-form-item">
                                                                    <div class="layui-form-label label_select" style="padding: 0;overflow: visible;">
                                                                        {if $vo['project_type']==1}收费标准{elseif($vo['project_type']==2)}收费说明{/if}
                                                                    </div>
                                                                    <div class="layui-input-block">
                                                                        {if $vo['project_type']==1}
                                                                        <div class="template_type1">
                                                                            <div class="disf">
                                                                                <table class="table_diy">
                                                                                    <thead>
                                                                                    <tr>
                                                                                        <th>币种</th>
                                                                                        <th>金额</th>
                                                                                        <th>计价单位</th>
                                                                                        {if $vo['quote_type']==1}
                                                                                        <th>报价说明</th>
                                                                                        {elseif($vo['quote_type']==2)}
                                                                                        <th>有效期限</th>
                                                                                        {elseif($vo['quote_type']==3)}
                                                                                        {if $vo['range_type']==1}
                                                                                        <th>适用国地</th>
                                                                                        {elseif($vo['range_type']==2)}
                                                                                        <th>适用货物</th>
                                                                                        {/if}
                                                                                        {/if}
                                                                                    </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                    <tr>
                                                                                        <td>{$vo['currency']}</td>
                                                                                        <td>{$vo['money']}</td>
                                                                                        <td>{if $vo['unit_type']==1}{$vo['unit']}{elseif($vo['unit_type']==2)}{$vo['unit_name']}{/if}</td>
                                                                                        {if $vo['quote_type']==1}
                                                                                        <td>{$vo['remark']}</td>
                                                                                        {elseif($vo['quote_type']==2)}
                                                                                        <td>{$vo['date']}</td>
                                                                                        {elseif($vo['quote_type']==3)}
                                                                                            {if $vo['range_type']==1}
                                                                                            <td>{if $vo['country_type']==1}{$vo['country']}{elseif($vo['country_type']==2)}{$vo['country_name']}{/if}</td>
                                                                                            {elseif($vo['range_type']==2)}
                                                                                            <td>{if $vo['value_type']==1}{$vo['value']}{elseif($vo['value_type']==2)}{$vo['value']}{/if}</td>
                                                                                            {/if}
                                                                                        {/if}
                                                                                    </tr>
                                                                                    </tbody>
                                                                                </table>

                                                                            </div>
                                                                        </div>
                                                                        {/if}
                                                                        {if $vo['project_type']==2}
                                                                        <div class="template_type2">
                                                                            <table class="table_diy">
                                                                                <tbody>
                                                                                {if $vo['feedesc_type']==1}
                                                                                {volist name="vo.quote_text1" id="vo2"}
                                                                                <tr>
                                                                                    <td>{$vo2}</td>
                                                                                </tr>
                                                                                {/volist}
                                                                                {/if}
                                                                                {if $vo['feedesc_type']==2}
                                                                                {volist name="vo.quote_text2" id="vo2"}
                                                                                <tr>
                                                                                    <td>{$vo2}</td>
                                                                                </tr>
                                                                                {/volist}
                                                                                {/if}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                        {/if}
                                                                        <div class="right" style="display: none;">
                                                                            <div class="layui-btn layui-btn-warm layui-btn-md" onclick="chat('{$vo[\'project_name\']}','{$vo[\'project_randname\']}')"><img src="/img/chat.png" style="width: 30px;height:30px;">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                        </fieldset>
                                                    </div>
                                                    {/volist}
                                                {elseif($data['is_quote']==0)}
                                                    {volist name="data['form']" key="key" id="vo"}
                                                        {if $vo['label_value']==5}
                                                            {if !empty($data['label5_select'])}
                                                                {volist name="data['label5_select']" index="key2" id="vo2"}
                                                                    {if $vo2==$vo.label_name}
                                                                    <div class="layui-form-item">
                                                                        <div class="layui-form-label">{$vo2}</div>
                                                                        <div class="layui-input-block word_color">
                                                                            {$data['label5_content'][$key]}
                                                                        </div>
                                                                    </div>
                                                                    {/if}
                                                                {/volist}
                                                            {/if}
                                                        {else}
                                                            <div class="layui-form-item">
                                                                <div class="layui-form-label">{$vo.label_name}</div>
                                                                <div class="layui-input-block word_color">
                                                                    {$data['content'][$key-1]}
                                                                </div>
                                                            </div>
                                                        {/if}
                                                    {/volist}
                                                {/if}
                                            {/if}
                                            {if !empty($data['text'])}
                                                <div class="layui-form-item">
                                                    <div class="layui-form-label">询价信息</div>
                                                    <div class="layui-input-block word_color">
                                                        {$data['text']}
                                                    </div>
                                                </div>
                                            {/if}
                                            {if !empty($data['files'])}
                                            <div class="layui-form-item">
                                                <label class="layui-form-label">我的文件</label>
                                                <div class="layui-input-block layui-select-fscon word_color">
                                                    {volist name="data['files']" key="k" id="v"}
                                                    <a href="https://www.gogo198.net{$v['files']}" target="_blank" class="word_color" style="margin-right:2px;text-decoration: underline;">{$v['filenames']}</a>
                                                    {/volist}
                                                </div>
                                            </div>
                                            {/if}
                                        </div>
                                    </fieldset>
                                    <div class="right">
                                        <div class="layui-btn layui-btn-warm layui-btn-md" onclick="chat('{$data[\'ordersn\']}',0)"><img src="/img/chat.png" style="width: 30px;height:30px;">
                                        </div>
                                    </div>

                                    {if !empty($quote_info)}
                                        <fieldset class="layui-elem-field quote_box">
                                            <legend style="width:unset;border-bottom:0;">报价详情</legend>
                                            <div class="layui-field-box" style="padding:0 10px;">
                                                {if !empty($quote_info['content'])}
                                                    <div class="main_template">
                                                        {volist name="quote_info['content']" key="key" id="vo"}
                                                        <fieldset class="layui-elem-field template_box">
                                                            <legend class="disf disf_legend">{$vo['project_name']}</legend>
                                                            <div class="layui-field-box" style="padding:0 0px;">
                                                                <div class="layui-form-item">
                                                                    <div class="layui-form-label label_select" style="padding: 0;overflow: visible;">
                                                                        {if $vo['project_type']==1}收费标准{elseif($vo['project_type']==2)}收费说明{/if}
                                                                    </div>
                                                                    <div class="layui-input-block label_block">
                                                                        {if $vo['project_type']==1}
                                                                        <div class="template_type1">
                                                                            <div class="disf">
                                                                                <table class="table_diy">
                                                                                    <thead>
                                                                                    <tr>
                                                                                        <th>币种</th>
                                                                                        <th>金额</th>
                                                                                        <th>计价单位</th>
                                                                                        {if $vo['quote_type']==1}
                                                                                        <th>报价说明</th>
                                                                                        {elseif($vo['quote_type']==2)}
                                                                                        <th>有效期限</th>
                                                                                        {elseif($vo['quote_type']==3)}
                                                                                            {if $vo['range_type']==1}
                                                                                            <th>适用国地</th>
                                                                                            {elseif($vo['range_type']==2)}
                                                                                            <th>适用货物</th>
                                                                                            {/if}
                                                                                        {/if}
                                                                                    </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                    <tr>
                                                                                        <td>{$vo['currency']}</td>
                                                                                        <td>{$vo['money']}</td>
                                                                                        <td>{if $vo['unit_type']==1}{$vo['unit']}{elseif($vo['unit_type']==2)}{$vo['unit_name']}{/if}</td>
                                                                                        {if $vo['quote_type']==1}
                                                                                        <td>{$vo['remark']}</td>
                                                                                        {elseif($vo['quote_type']==2)}
                                                                                        <td>{$vo['date']}</td>
                                                                                        {elseif($vo['quote_type']==3)}
                                                                                            {if $vo['range_type']==1}
                                                                                            <td>{if $vo['country_type']==1}{$vo['country']}{elseif($vo['country_type']==2)}{$vo['country_name']}{/if}</td>
                                                                                            {elseif($vo['range_type']==2)}
                                                                                            <td>{if $vo['value_type']==1}{$vo['value']}{elseif($vo['value_type']==2)}{$vo['value']}{/if}</td>
                                                                                            {/if}
                                                                                        {/if}
                                                                                    </tr>
                                                                                    </tbody>
                                                                                </table>

                                                                            </div>
                                                                        </div>
                                                                        {/if}
                                                                        {if $vo['project_type']==2}
                                                                        <div class="template_type2">
                                                                            <table class="table_diy">
                                                                                <tbody>
                                                                                    {if $vo['feedesc_type']==1}
                                                                                    {volist name="vo.quote_text1" id="vo2"}
                                                                                    <tr>
                                                                                    <td>{$vo2}</td>
                                                                                    </tr>
                                                                                    {/volist}
                                                                                    {/if}
                                                                                    {if $vo['feedesc_type']==2}
                                                                                    {volist name="vo.quote_text2" id="vo2"}
                                                                                    <tr>
                                                                                    <td>{$vo2}</td>
                                                                                    </tr>
                                                                                    {/volist}
                                                                                    {/if}
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                        {/if}
                                                                        <div class="right">
                                                                            <div class="layui-btn layui-btn-warm layui-btn-md" onclick="chat('{$vo[\'project_name\']}','{$vo[\'project_randname\']}')"><img src="/img/chat.png" style="width: 30px;height:30px;">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </fieldset>
                                                        {/volist}
                                                    </div>
                                                {/if}
                                                {if !empty($quote_info['text'])}
                                                    <div class="layui-form-item">
                                                        <div class="layui-form-label">报价信息</div>
                                                        <div class="layui-input-block word_color">
                                                            {$quote_info['text']}
                                                        </div>
                                                    </div>
                                                {/if}
                                            </div>
                                        </fieldset>
                                    {else}
                                        <div class="layui-form-item">
                                            <label class="layui-form-label" style="padding:0;width:0;"></label>
                                            <div class="layui-input-block disf" style="margin-left:0;justify-content: center;margin-top:10px;">
                                                <div id="template_id" class="xm-select-demo" style="min-width:160px;"></div>
<!--                                                <select name="template_id" lay-search lay-verify="required" lay-filter="template_id">-->
<!--                                                    <option value="">使用模板报价</option>-->
<!--&lt;!&ndash;                                                    <option value="-1">无合适模板，自定义模板</option>&ndash;&gt;-->
<!--                                                    <option value="-2">文本信息报价</option>-->
<!--                                                    volist name="quote_temp" key="idx" id="vo"-->
<!--                                                        <option value="$vo.id">$vo.template_name</option>-->
<!--                                                    /volist-->
<!--                                                </select>-->
                                                <div class="layui-btn layui-btn-primary layui-btn-md" onclick="add_template()" style="margin-left:30px;width:150px;">
                                                    新增模板报价
                                                </div>
                                            </div>
                                        </div>
                                        <fieldset class="layui-elem-field quote_box">
                                            <legend style="width:unset;border-bottom:0;">报价详情</legend>
                                            <div class="layui-field-box" style="padding:0 10px;">
                                                
                                            </div>
                                        </fieldset>
                                    {/if}
                                </div>
                                <div class="layui-form-item" style="margin-top: 25px;text-align: center;">
                                    <div>
                                        {if empty($quote_info)}
                                            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="component-form-element2">确认报价</button>
                                        {elseif($data['quote_id']==$quote_info['id'] && $data['status']==2)}
                                            <button class="layui-btn layui-btn-normal" lay-submit lay-filter="component-form-element3">确认接单</button>
                                        {/if}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="chatBox_con" style="display: none;">
    <div class="layui-fluid">
        <div class="layui-card">
<!--            <div class="layui-card-header" style="background: #0a8ddf;color:#fff;">咨询[<span class="consult_name"></span>]</div>-->
            <div class="layui-card-body" style="padding: 15px;background:#fff;">
                <form class="layui-form" action="" lay-filter="component-form-group">
                    <input type="hidden" name="quote_id" id="quote_id" value="">
                    <input type="hidden" name="project_randname" id="project_randname" value="">
                    <div class="layui-col-xs12 chat_content">

                    </div>
                    <div class="layui-form-item">
                        <div class="layui-tab layui-tab-card">
                            <ul class="layui-tab-title">
                                <li class="layui-this" data-i='1'>普通文本</li>
                                <li data-i='2'>富文本</li>
                            </ul>
                            <div class="layui-tab-content">
                                <div class="layui-tab-item layui-show">
                                    <textarea class="layui-textarea" name="content" placeholder="开始聊天~~"></textarea>
                                </div>
                                <div class="layui-tab-item">
                                    <script id="content_chat" type="text/plain" style="width:100%;height:100px;color:#000 !important;">
                                    </script>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-xs12" style="text-align: center;">
                            <button class="layui-btn" lay-submit="" lay-filter="component-form-demo1" style="margin-top:10px;">立即提交</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script src="./layui/xm-select.js"></script>
<script type="text/javascript">
    var label5_select = [];
    layui.use(['layer','form','laydate','upload','element'],function(){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate
            , element = layui.element
            , upload = layui.upload;

        form.render(null, 'component-form-element');

        xmSelect.render({
            el: '#template_id',
            name:'template_id',
            autoRow: true, //自动换行
            filterable: true, //可搜索
            searchTips: '请选择',
            radio:true,
            model: {
                icon: 'hidden',//是否展示复选框或者单选框图标 show, hidden:变换背景色  ！！这句话是重点，不然会变成父节点也有单选框！！
            },
            tree: {
                show: true, //用树显示
                showFolderIcon: true, //是否显示节点前的三角图标
                expandedKeys: true, //默认全部展开
                showLine: true, //显示渐近线
                indent: 20, //间距
                strict: false, //重点！！设置成非严格父子模式，这样父节点被禁用，子节点依然可以点击
                clickCheck:true,
            },
            toolbar: {
                show: false, //显示工具条
                list: ['ALL', 'REVERSE', 'CLEAR']
            },
            height: '300px', //最大下拉框高度
            data: {$temp_menu},
            on:function(data){
                let html = '';
                if(data.change[0].value!=-2){
                    $.ajax({
                        url: "/?s=index/select_template",
                        method: 'post',
                        data: {'id': data.change[0].value},
                        dataType: 'JSON',
                        success: function (res) {
                            if (res.code == 0) {
                                $('.quote_box').find('.layui-field-box').html('');

                                    html += '                            <div class="main_template">\n' +
                                        '                                    <div class="project_box" style="margin-top:0px;">\n';
                                    for (let i = 0; i < res.content.length; i++) {
                                        html += '                                <div class="addBox">\n' +
                                        '                                            <fieldset class="layui-elem-field template_box">\n' +
                                        '                                                <legend class="disf disf_legend" style="width: 38%;padding-right: 0 !important;margin-right: 0 !important;padding-left: 0;"><input type="text" name="project_name[]" class="layui-input template_remark f15" id="project_name" placeholder="请输入收费项目或摘要" value="'+res.content[i].project_name+'" /><input type="text" name="project_randname[]" value="'+res.content[i].project_randname+'" style="display: none;"></legend>\n' +
                                        '                                                    <div class="layui-field-box" style="padding-left:20px;">\n' +
                                        '                                                        <div class="layui-form-item">\n' +
                                        '                                                            <div class="layui-form-label label_select" style="padding: 0;overflow: visible;">\n' +
                                        '                                                                <select name="project_type[]" id="project_type" lay-filter="project_type">\n';
                                        if(res.content[i].project_type==1){
                                            html += '                                                        <option value="1" selected>收费标准</option>\n';
                                        }else{
                                            html += '                                                        <option value="1">收费标准</option>\n';
                                        }

                                        if(res.content[i].project_type==2) {
                                            html += '                                                        <option value="2" selected>报价说明</option>\n';
                                        }else{
                                            html += '                                                        <option value="2">报价说明</option>\n';
                                        }
                                        html += '                                                         </select>\n' +
                                        '                                                            </div>\n' +
                                        '                                                            <div class="layui-input-block">\n';
                                        if(res.content[i].project_type==1){
                                            html += '                                                    <div class="template_type1" style="display:block;">\n';
                                        }else if(res.content[i].project_type==2){
                                            html += '                                                    <div class="template_type1" style="display:none;">\n';
                                        }

                                        html += '                                                             <div class="disf">\n' +
                                        '                                                                        <div class="input15">\n' +
                                        '                                                                            <select name="currency[]" id="currency" lay-search>\n';
                                                                                                                        {volist name="currency" key="key2" id="vo2"}
                                                                                                                        if("{$vo2.code_value}"==res.content[i].currency){
                                        html += '                                                                            <option value="{$vo2.code_value}" selected>{$vo2.code_name}</option>\n';
                                                                                                                        }else{
                                        html += '                                                                            <option value="{$vo2.code_value}">{$vo2.code_name}</option>\n';
                                                                                                                        }
                                                                                                                        {/volist}
                                        html += '                                                                    </select>\n' +
                                        '                                                                        </div>\n' +
                                        '                                                                        <input type="number" name="money[]" class="layui-input input15" id="money" placeholder="请输入金额" value="'+res.content[i].money+'"/>\n' +
                                        '                                                                        </div>\n' +
                                        '                                                                        <div class="disf">\n' +
                                        '                                                                            <div class="input15">\n' +
                                        '                                                                               <select name="unit_type[]" id="unit_type" lay-filter="unit_type">\n';
                                                                                                                        if(res.content[i].unit_type==1){
                                        html += '                                                                             <option disabled selected value="1">- 计价单位</option>\n';
                                                                                                                        }else{
                                        html += '                                                                             <option disabled value="1">- 计价单位</option>\n';
                                                                                                                        }
                                        html += '                                                                             <option value="1">选择表</option>\n';
                                                                                                                        if(res.content[i].unit_type==2) {
                                        html += '                                                                             <option value="2" selected>自定义</option>\n';
                                                                                                                        }else{
                                        html += '                                                                             <option value="2">自定义</option>\n';
                                                                                                                        }
                                        html += '                                                                       </select>\n' +
                                        '                                                                            </div>\n';
                                        html += '                                                                         <div class="unit input15" style="display:block;">\n' +
                                            '                                                                              <select name="unit[]" id="unit" lay-search>\n';
                                                                                                                        if(res.content[i].unit_type==1) {
                                                                                                                                {volist name="unit" key="key2" id="vo2"}
                                                                                                                            if(res.content[i].unit=="{$vo2.code_value}") {
                                        html += '                                                                                <option value="{$vo2.code_value}" selected>{$vo2.code_name}</option>\n';
                                                                                                                            }else{
                                        html += '                                                                                <option value="{$vo2.code_value}">{$vo2.code_name}</option>\n';
                                                                                                                            }
                                                                                                                            {/volist}
                                                                                                                        }
                                        html += '                                                                          </select>\n' +
                                            '                                                                             </div>\n';
                                                                                                                        if(res.content[i].unit_type==1) {
                                        html += '                                                                        <input type="text" name="unit_name[]" class="layui-input input15 unit_name" id="unit_name" style="display:none;" placeholder="自定义单位" value="'+res.content[i].unit_name+'"/>\n';
                                                                                                                        }else{
                                        html += '                                                                        <input type="text" name="unit_name[]" class="layui-input input15 unit_name" id="unit_name" style="display:block;" placeholder="自定义单位" value="'+res.content[i].unit_name+'"/>\n';
                                                                                                                        }
                                        html += '                                                                    </div>\n' +
                                        '                                                                    <div class="disf baojia">\n' +
                                        '                                                                        <div class="input15">\n' +
                                        '                                                                            <select name="quote_type[]" id="quote_type" lay-filter="quote_type">\n';
                                                                                                                        if(res.content[i].quote_type==1){
                                        html += '                                                                           <option disabled selected value="1">- 报价说明</option>\n';
                                                                                                                        }else{
                                        html += '                                                                           <option disabled value="1">- 报价说明</option>\n';
                                                                                                                        }
                                        html += '                                                                                <option value="1">自定义</option>\n';
                                                                                                                        if(res.content[i].quote_type==2) {
                                        html += '                                                                                <option value="2" selected>有效期限</option>\n';
                                                                                                                        }else{
                                        html += '                                                                                <option value="2">有效期限</option>\n';
                                                                                                                        }
                                                                                                                        if(res.content[i].quote_type==3) {
                                        html += '                                                                                <option value="3" selected>适用范围</option>\n';
                                                                                                                        }else{
                                        html += '                                                                                <option value="3">适用范围</option>\n';
                                                                                                                        }
                                        html += '                                                                    </select>\n' +
                                        '                                                                        </div>\n';
                                                                                                                        if(res.content[i].quote_type==1){
                                        html += '                                                                          <input type="text" name="remark[]" class="layui-input remark input15" id="remark" placeholder="请输入报价说明" value="'+res.content[i].remark+'"  style="display: block;"/>\n';
                                                                                                                        }else{
                                        html += '                                                                          <input type="text" name="remark[]" class="layui-input remark input15" id="remark" placeholder="请输入报价说明" value="'+res.content[i].remark+'"  style="display: none;"/>\n';
                                                                                                                        }
                                                                                                                        if(res.content[i].quote_type==2) {
                                        html += '                                                                        <div class="disf date_type input50" style="display: flex;">\n';
                                                                                                                        }else{
                                        html += '                                                                        <div class="disf date_type input50" style="display: none;">\n';
                                                                                                                        }
                                        html += '                                                                      <div class="input30">\n' +
                                        '                                                                                <select name="date_type[]" id="date_type" lay-filter="date_type">\n' +
                                        '                                                                                    <option disabled selected value="1">- 有效期限</option>\n';
                                                                                                                        if(res.content[i].date_type==1){
                                        html += '                                                                            <option value="1" selected>固定日期</option>\n';
                                                                                                                        }else{
                                        html += '                                                                            <option value="1">固定日期</option>\n';
                                                                                                                        }
                                                                                                                        if(res.content[i].date_type==2){
                                        html += '                                                                            <option value="2" selected>起止日期</option>\n';
                                                                                                                        }else{
                                        html += '                                                                            <option value="2">起止日期</option>\n';
                                                                                                                        }
                                        html += '                                                                         </select>\n' +
                                        '                                                                            </div>\n' +
                                        '                                                                            <div class="date_box">\n' +
                                        '                                                                                <input type="hidden" name="date_num[]" id="date_num" value="'+res.content[i].date_num+'">\n' +
                                        '                                                                                <input type="text" name="date[]" class="layui-input" id="date'+res.content[i].date_num+'" placeholder="选择日期" value="'+res.content[i].date+'" autocomplete="off" readonly/>\n' +
                                        '                                                                            </div>\n' +
                                        '                                                                        </div>\n';
                                                                                                                        if(res.content[i].quote_type==3) {
                                        html += '                                                                        <div class="range_type input15" style="display: inline-block;">\n';
                                                                                                                        }else{
                                        html += '                                                                        <div class="range_type input15" style="display:none;">\n';
                                                                                                                        }
                                        html += '                                                                    <select name="range_type[]" id="range_type" lay-filter="range_type">\n' +
                                        '                                                                                <option disabled selected value="1">- 适用范围</option>\n';
                                                                                                                         if(res.content[i].range_type==1) {
                                        html += '                                                                            <option value="1" selected>适用国地</option>\n';
                                                                                                                         }else{
                                        html += '                                                                            <option value="1">适用国地</option>\n';
                                                                                                                         }
                                                                                                                         if(res.content[i].range_type==2) {
                                        html += '                                                                            <option value="2" selected>适用货物</option>\n';
                                                                                                                         }else{
                                        html += '                                                                            <option value="2">适用货物</option>\n';
                                                                                                                         }
                                        html += '                                                                     </select>\n' +
                                        '                                                                        </div>\n';
                                                                                                                        if(res.content[i].range_type==1) {
                                        html += '                                                                <div class="disf country_type input50" style="display: flex;">\n';
                                                                                                                        }else{
                                        html += '                                                                <div class="disf country_type input50" style="display: none;">\n';
                                                                                                                        }
                                        html += '                                                                       <div class="input30">\n' +
                                        '                                                                                    <select name="country_type[]" id="country_type" lay-filter="country_type">\n';
                                                                                                                        if(res.content[i].country_type==1) {
                                        html += '                                                                                <option disabled selected value="1">- 适用国地</option>\n';
                                                                                                                        }else{
                                        html += '                                                                                <option disabled value="1">- 适用国地</option>\n';
                                                                                                                        }

                                        html += '                                                                                <option value="1">选择表</option>\n';
                                                                                                                        if(res.content[i].country_type==2) {
                                        html += '                                                                                <option value="2" selected>自定义</option>\n';
                                                                                                                        }else{
                                        html += '                                                                                <option value="2" >自定义</option>\n';
                                                                                                                        }
                                        html += '                                                                            </select>\n' +
                                        '                                                                                </div>\n';
                                                                                                                        if(res.content[i].country_type==1) {
                                        html += '                                                                         <div class="country input30" style="display:block;">\n';
                                                                                                                        }else{
                                        html += '                                                                         <div class="country input30" style="display:none;">\n';
                                                                                                                        }
                                        html += '                                                                        <select name="country[]" id="country" lay-search>\n';
                                                                                                                            {volist name="country" key="key2" id="vo2"}
                                                                                                                            if(res.content[i].country=="{$vo2.code_value}"){
                                        html += '                                                                           <option value="{$vo2.code_value}" selected>{$vo2.code_name}</option>\n';
                                                                                                                            }else{
                                        html += '                                                                           <option value="{$vo2.code_value}">{$vo2.code_name}</option>\n';
                                                                                                                            }
                                                                                                                            {/volist}
                                        html += '                                                                         </select>\n' +
                                        '                                                                            </div>\n';
                                                                                                                      if(res.content[i].country_type==2) {
                                        html += '                                                                         <input type="text" name="country_name[]" class="layui-input input30" id="country_name"  style="display:block;" placeholder="自定义国地" value="' + res.content[i].country_name + '"/>\n';
                                                                                                                      }else{
                                        html += '                                                                         <input type="text" name="country_name[]" class="layui-input input30" id="country_name"  style="display:none;" placeholder="自定义国地" value="' + res.content[i].country_name + '"/>\n';
                                                                                                                      }
                                        html += '                                                                   </div>\n';
                                                                                                                      if(res.content[i].range_type==2) {
                                        html += '                                                                        <div class="disf value_type input50" style="display: flex;">\n';
                                                                                                                      }else{
                                        html += '                                                                        <div class="disf value_type input50" style="display: none;">\n';
                                                                                                                      }
                                        html += '                                                                    <div class="input30">\n' +
                                        '                                                                                <select name="value_type[]" id="value_type" lay-filter="value_type">\n';
                                                                                                                      if(res.content[i].value_type==1){
                                        html += '                                                                           <option disabled selected value="1">- 适用货物</option>\n';
                                                                                                                      }else{
                                        html += '                                                                           <option disabled value="1">- 适用货物</option>\n';
                                                                                                                      }

                                        html += '                                                                            <option value="1">选择表</option>\n';
                                                                                                                        if(res.content[i].value_type==2) {
                                        html += '                                                                            <option value="2" selected>自定义</option>\n';
                                                                                                                        }else{
                                        html += '                                                                            <option value="2">自定义</option>\n';
                                                                                                                        }
                                        html += '                                                                          </select>\n' +
                                        '                                                                            </div>\n';
                                                                                                                        if(res.content[i].value_type==1){
                                        html += '                                                                          <div class="value input30" style="display: block;">\n';
                                                                                                                        }else{
                                        html += '                                                                          <div class="value input30" style="display: none;">\n';
                                                                                                                        }
                                        html += '                                                                          <select name="value[]" id="value" lay-search>\n';
                                                                                                                            {volist name="value" key="key2" id="vo2"}
                                                                                                                            if(res.content[i].value=="{$vo2.id}") {
                                        html += '                                                                               <option value="{$vo2.id}" selected>{$vo2.name}</option>\n';
                                                                                                                            }else{
                                        html += '                                                                               <option value="{$vo2.id}">{$vo2.name}</option>\n';
                                                                                                                            }
                                                                                                                            {/volist}
                                        html += '                                                                                </select>\n' +
                                        '                                                                            </div>\n';
                                                                                                                        if(res.content[i].value_type==2) {
                                        html += '                                                                          <input type="text" name="value_name[]" class="layui-input input30" id="value_name" style="display: block;" placeholder="自定义货物" value="'+res.content[i].value_name+'"/>\n';
                                                                                                                        }else{
                                        html += '                                                                          <input type="text" name="value_name[]" class="layui-input input30" id="value_name" style="display: none;" placeholder="自定义货物" value="'+res.content[i].value_name+'"/>\n';
                                                                                                                        }
                                        html += '                                                                    </div>\n' +
                                        '                                                                    </div>\n' +
                                        '                                                                </div>\n';
                                                                                                           if(res.content[i].project_type==2) {
                                        html += '                                                        <div class="template_type2" style="display:block;">\n';
                                                                                                           }else{
                                        html += '                                                        <div class="template_type2" style="display:none;">\n';
                                                                                                           }
                                        html += '                                                           <div class="input30">\n' +
                                        '                                                                        <select name="feedesc_type[]" id="feedesc_type" lay-filter="feedesc_type">\n';
                                                                                                           if(res.content[i].feedesc_type==1){
                                        html += '                                                                    <option value="1" selected>说明文本</option>\n';
                                                                                                           }else{
                                        html += '                                                                    <option value="1">说明文本</option>\n';
                                                                                                           }
                                                                                                           if(res.content[i].feedesc_type==2) {
                                        html += '                                                                    <option value="2" selected>选择文本</option>\n';
                                                                                                           }else{
                                        html += '                                                                    <option value="2">选择文本</option>\n';
                                                                                                           }
                                        html += '                                                                </select>\n' +
                                        '                                                                    </div>\n';
                                                                                                           if(res.content[i].feedesc_type==1) {
                                        html += '                                                             <div class="quote_type1" style="display:block;">\n';
                                                                                                           }else{
                                        html += '                                                             <div class="quote_type1" style="display:none;">\n';
                                                                                                           }
                                                                                                           if(res.content[i].quote_text1!=''){
                                                                                                               for(let i2=0;i2<res.content[i].quote_text1.length;i2++){
                                        html += '                                                                        <div class="marbtm10 disf">\n' +
                                            '                                                                                <div class="layui-btn layui-btn-md layui-btn-danger f22" onclick="del_text(this)">-</div>\n';
                                            if(res.content[i].quote_text1[i2]!=''){
                                        html += '                                                                                <div class="layui-input input20 fake_input" onclick="open_textarea(this)">'+res.content[i].quote_text1[i2]+'</div>\n';
                                            }else{
                                        html += '                                                                                <div class="layui-input input20 fake_input" onclick="open_textarea(this)">请输入文本</div>\n';
                                            }
                                        html += '                                                                                <div class="this_textarea">\n' +
                                            '                                                                                    <textarea name="quote_text1['+i+'][]" id="quote_text" class="layui-textarea" style="height:500px;" placeholder="请输入文本">'+res.content[i].quote_text1[i2]+'</textarea>\n' +
                                            '                                                                                    <div class="layui-btn layui-btn-md layui-btn-normal" onclick="sure_this(this)">确认</div>\n' +
                                            '                                                                                </div>\n' +
                                            '                                                                                <div class="layui-btn layui-btn-md layui-btn-success f22" onclick="add_text('+i+',this,1)">+</div>\n' +
                                            '                                                                            </div>\n';
                                                                                                               }
                                                                                                           }else{
                                        html += '                                                                 <div class="marbtm10 disf">\n' +
                                           '                                                                            <div class="layui-btn layui-btn-md layui-btn-danger f22" style="background:#e38787;">-</div>\n' +
                                           '                                                                            <div class="layui-input input20 fake_input" onclick="open_textarea(this)">请输入文本</div>\n' +
                                           '                                                                            <div class="this_textarea">\n' +
                                           '                                                                                <textarea name="quote_text1['+i+'][]" id="quote_text" class="layui-textarea" style="height:500px;" placeholder="请输入文本" value=""></textarea>\n' +
                                           '                                                                                <div class="layui-btn layui-btn-md layui-btn-normal" onclick="sure_this(this)">确认</div>\n' +
                                           '                                                                            </div>\n' +
                                           '                                                                            <div class="layui-btn layui-btn-md layui-btn-success f22" onclick="add_text('+i+',this,1)">+</div>\n' +
                                           '                                                                        </div>\n';
                                                                                                           }
                                        html += '                                                        </div>\n';
                                                                                                         if(res.content[i].feedesc_type==2){
                                        html += '                                                                <div class="quote_type2" style="display:block;">\n';
                                                                                                         }else{
                                        html += '                                                                <div class="quote_type2" style="display:none;">\n';
                                                                                                         }
                                                                                                         if(res.content[i].quote_text2!=''){
                                                                                                             for(let i2=0;i2<res.content[i].quote_text2.length;i2++){
                                        html += '                                                                 <div class="marbtm10 disf">\n' +
                                         '                                                                            <div class="layui-btn layui-btn-md layui-btn-danger f22" onclick="del_text(this)">-</div>\n' +
                                         '                                                                            <div class="input20">\n' +
                                         '                                                                                <select name="quote_text2['+i+'][]" id="quote_text" class="quote_select" lay-search lay-filter="quote_text">\n';
                                                                                                                             {volist name="quote_text" key="key3" id="vo3"}
                                                                                                                             if("{$vo3.id}"==res.content[i].quote_text2[i2]){
                                         html += '                                                                               <option value="{$vo3.id}" selected>{$vo3.text}</option>\n';
                                                                                                                             }else{
                                         html += '                                                                               <option value="{$vo3.id}">{$vo3.text}</option>\n';
                                                                                                                             }
                                                                                                                             {/volist}
                                         html += '                                                                        </select>\n' +
                                         '                                                                                <div class="this_textarea">\n' +
                                         '                                                                                    <textarea name="quote_text2_edit['+i+'][]" id="quote_text" class="layui-textarea quote_text" style="height:500px;" placeholder="请输入文本"></textarea>\n' +
                                         '                                                                                    <div class="layui-btn layui-btn-md layui-btn-normal" onclick="sure_this2(this)">无需修改</div>\n' +
                                         '                                                                                    <div class="layui-btn layui-btn-md layui-btn-primary" onclick="sure_this3(this)">确认修改</div>\n' +
                                         '                                                                                </div>\n' +
                                         '                                                                            </div>\n' +
                                         '                                                                            <div class="layui-btn layui-btn-md layui-btn-success f22" onclick="add_text('+i+',this,2)">+</div>\n' +
                                         '                                                                        </div>\n';
                                                                                                             }
                                                                                                         }else{
                                         html += '                                                            <div class="marbtm10 disf">\n' +
                                             '                                                                        <div class="layui-btn layui-btn-md layui-btn-danger f22" style="background:#e38787;">-</div>\n' +
                                             '                                                                        <div class="input20">\n' +
                                             '                                                                            <select name="quote_text2['+i+'][]" id="quote_text" class="quote_select" lay-search lay-filter="quote_text">\n';
                                                                                                                             {volist name="quote_text" key="key2" id="vo2"}
                                             html += '                                                                           <option value="{$vo2.id}">{$vo2.text}</option>\n';
                                                                                                                             {/volist}
                                             html += '                                                                    </select>\n' +
                                             '                                                                            <div class="this_textarea">\n' +
                                             '                                                                                <textarea name="quote_text2_edit['+i+'][]" id="quote_text" class="layui-textarea quote_text" style="height:500px;" placeholder="请输入文本"></textarea>\n' +
                                             '                                                                                <div class="layui-btn layui-btn-md layui-btn-normal" onclick="sure_this2(this)">无需修改</div>\n' +
                                             '                                                                                <div class="layui-btn layui-btn-md layui-btn-primary" onclick="sure_this3(this)">确认修改</div>\n' +
                                             '                                                                            </div>\n' +
                                             '                                                                        </div>\n' +
                                             '                                                                        <div class="layui-btn layui-btn-md layui-btn-success f22" onclick="add_text('+i+',this,2)">+</div>\n' +
                                             '                                                                    </div>\n';
                                                                                                         }
                                        html += '                                                       </div>\n' +
                                        '                                                        </div>\n' +
                                        '                                                    </div>\n' +
                                        '                                                </div>\n' +
                                        '                                            </div>\n' +
                                        '                                        </fieldset>\n' +
                                        '                                        </div>\n';
                                    }
                                html += '                                    </div>\n' +
                                    '                                </div>\n';

                                $('.quote_box').find('.layui-field-box').html(html);
                                form.render(null,'component-form-element');
                                for (let i = 0; i < res.content.length; i++) {
                                    if(res.content[i].quote_type==2){
                                        if(res.content[i].date_type==1){
                                            laydate.render({
                                                elem: '#date'+res.content[i].date_num
                                            });
                                        }else if(res.content[i].date_type==2){
                                            laydate.render({
                                                elem: '#date'+res.content[i].date_num //指定元素
                                                ,range:true
                                                ,min: "<?php echo date('Y-m-d');?>"
                                                ,max: "<?php echo date('Y-m-d',time()+63072000)?>"
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                else if(data.change[0].value==-2){
                    html ='<div class="layui-form-item">\n' +
                        '                            <div class="layui-form-label">报价信息</div>\n' +
                        '                            <div class="layui-input-block">\n'+
                        '                               <textarea name="text" id="text" class="layui-textarea" placeholder="请输入报价文本信息" lay-verify="required"></textarea>\n'+
                        '                            </div>\n'+
                        '       </div>\n';
                }

                $('.quote_box').find('.layui-field-box').append(html);
                form.render(null,'component-form-element');
            }
            // initValue:[$data['navbar_id']]
        });

        $('.chat_content').scrollTop($('.chat_content').height(), -1);
        var ue = UE.getEditor('content_chat', {
            initialFrameHeight: 400,
            serverUrl: 'cklein/plugins/ueditor/php/controller.php'
        });
        /* 监听提交聊天记录 */
        form.on('submit(component-form-demo1)', function (data) {
            data.field['content_type']=1;
            data.field['pa']=2;
            if($('.chatBox_con').find('.layui-this').attr('data-i')==2){
                data.field['content_type']=2;
                data.field['content'] = data.field['editorValue'];
            }
            if("{$data['mid']}">0){
                data.field['who_send']=2;
            }
            if(data.field['content']==''){
                layer.msg('请输入内容！');
                return false;
            }

            $.ajax({
                url: "/?s=index/quote_chat",
                method: 'post',
                data: data.field,
                dataType: 'JSON',
                success: function (res) {
                    layer.msg(res.msg, {time: 2000}, function () {
                        if (res.code == 0) {
                            // var index = parent.layer.getFrameIndex(window.name);
                            // parent.layer.close(index);
                            // window.location.reload();
                            chat('',data.field['project_randname'],1);
                        }
                    });
                },
                error: function (data) {
                    layer.msg('系统错误', {time: 2000});
                }
            });
            return false;
        });

        form.on('select(template_id)',function(data){
            let val = data.value;
            if(val==-1){
                layer.open({
                    type: 2,
                    title: '添加模板',
                    shadeClose: true,
                    shade: 0.3,
                    area: ['100%', '100%'],
                    content: "/?s=index/save_template&buss_pid={$data['buss_pid']}&buss_id={$data['buss_id']}",
                });
            }
            else if(val==-2){
                $('.quote_box').find('.layui-field-box').html('');
                let html = '<div class="layui-form-item">\n' +
                    '                            <div class="layui-form-label">报价信息</div>\n' +
                    '                            <div class="layui-input-block">\n'+
                    '                               <textarea name="text" id="text" class="layui-textarea" placeholder="请输入报价文本信息" lay-verify="required"></textarea>\n'+
                    '                            </div>\n'+
                    '       </div>\n';
                $('.quote_box').find('.layui-field-box').append(html);
                form.render(null,'component-form-element');
            }
            else{
                $.ajax({
                    url:"/?s=index/select_template",
                    method:'post',
                    data:{'id':val},
                    dataType:'JSON',
                    success:function(res){
                        if(res.code==0){
                            $('.quote_box').find('.layui-field-box').html('');
                            let html = '';
                            for(let i=0;i<res.content.length;i++){
                                if(res.content[i]['label_value']!=5){
                                    html += '<div class="layui-form-item">\n' +
                                        '                            <div class="layui-form-label">'+res.content[i]['label_name']+'</div>\n' +
                                        '                            <div class="layui-input-block">\n';
                                    if(res.content[i]['label_value']==1){
                                        html += '<input type="text" name="content[]" class="layui-input" value="" placeholder="" lay-verify="required"/>\n';
                                    }else if(res.content[i]['label_value']==2){
                                        html += '<input type="number" name="content[]" class="layui-input" value="" placeholder="" lay-verify="required"/>\n';
                                    }else if(res.content[i]['label_value']==3){
                                        html += ' <input type="text" name="content[]" class="layui-input" id="date'+res.content[i]['label_rand']+'" value="" placeholder="yymmddhhii" lay-verify="required">\n';
                                    }else if(res.content[i]['label_value']==4){
                                        html += '<select name="content[]" lay-search lay-verify="required">\n';
                                        for(let j=0;j<res.content[i]['label_select'].length;j++){
                                            html += '<option value="'+res.content[i]['label_select'][j]+'">'+res.content[i]['label_select'][j]+'</option>\n';
                                        }
                                        html += '</select>\n';
                                    }else if(res.content[i]['label_value']==51){
                                        html += '<div class="quantity">\n' +
                                            '         <button type="button" onclick="decrementValue(event)">-</button>\n' +
                                            '         <input type="number" class="layui-input" name="content[]" value="0" oninput="if(value>1000)value=1000;if(value.length>4)value=value.slice(0,4);if(value<0)value=0" />\n' +
                                            '         <button type="button" onclick="incrementValue(event)">+</button>\n' +
                                            '    </div>\n';
                                        if(res.content[i]['label_introduce']!=''){
                                            html += '<span style="font-size: 12px;color: #888;">'+res.content[i]['label_introduce']+'</span>\n';
                                        }
                                    }else if(res.content[i]['label_value']==6){
                                        html += ' <input type="text" name="content[]" class="layui-input" id="date'+res.content[i]['label_rand']+'" value="" placeholder="yymmddhhii" lay-verify="required">\n';
                                    }
                                    html += '                            </div>\n' +
                                        '                        </div>';
                                }
                            }

                            label5_select = res.label5;
                            if(res.label5!=''){
                                html += '<div class="label5">\n' +
                                    '                                                        <div class="layui-form-item">\n' +
                                    '                                                            <div class="layui-form-label" style="color:#000;padding:0;overflow:visible;">\n' +
                                    '                                                                <select name="label5_select[]" class="tmp" lay-search lay-filter="tmp" lay-verify="required">\n' +
                                    '                                                                    <option value="">请选择</option>\n';
                                for(let j=0;j<res.label5.length;j++){
                                    html += '                                                        <option value="'+res.label5[j].label_name+'" data-introduce="'+res.label5[j].label_introduce+'">'+res.label5[j].label_name+'</option>\n';
                                }
                                html += '                                                                </select>\n' +
                                    '                                                            </div>\n' +
                                    '                                                            <div class="layui-input-block">\n' +
                                    '                                                                <div class="disf" style="align-items: baseline;">\n' +
                                    '                                                                    <div class="layui-col-xs12" style="margin-right:5px;">\n' +
                                    '                                                                        <div class="quantity">\n' +
                                    '                                                                            <button type="button" class="word_color" onclick="decrementValue(event)">-</button>\n' +
                                    '                                                                            <input type="number" class="layui-input" name="label5_content[]" value="0" oninput="if(value>1000)value=1000;if(value.length>4)value=value.slice(0,4);if(value<0)value=0" />\n' +
                                    '                                                                            <button type="button" class="word_color" onclick="incrementValue(event)">+</button>\n' +
                                    '                                                                        </div>\n' +
                                    '                                                                        <span class="label_introduce" style="font-size: 12px;color: {$website[\'color_word\']};"></span>\n' +
                                    '                                                                    </div>\n' +
                                    '                                                                    <div class="layui-btn layui-btn-md layui-btn-primary" onclick="add_label5(this)">增加</div>\n' +
                                    '                                                                </div>\n' +
                                    '                                                            </div>\n' +
                                    '                                                        </div>\n' +
                                    '                                                    </div>';
                            }
                            
                            $('.quote_box').find('.layui-field-box').append(html);
                            form.render(null,'component-form-element');
                            for(let i=0;i<res.content.length;i++){
                                if(res.content[i]['label_value']==3){
                                    laydate.render({
                                        elem: '#date'+res.content[i]['label_rand'] //指定元素
                                        ,min: "<?php echo date('Y-m-d');?>"
                                    });
                                }else if(res.content[i]['label_value']==6){
                                    laydate.render({
                                        elem: '#date'+res.content[i]['label_rand'] //指定元素
                                        ,range: true
                                        ,min: "<?php echo date('Y-m-d');?>"
                                        ,max: "<?php echo date('Y-m-d',time()+63072000)?>"
                                    });
                                    if(IsPhone()) {
                                        $("#date"+res.content[i]['label_rand']).click(function () {
                                            setTimeout(function () {
                                                $('.layui-laydate-range').css('width', '100%');
                                            }, 500);
                                        });
                                    }
                                }
                            }
                        }
                    }
                });
            }
        });

        form.on('select(tmp)',function(data){
            let val = data.value;
            let e = data.elem;
            var introduce = e[e.selectedIndex].dataset.introduce;

            $(this).parent().parent().parent().siblings('.layui-input-block').find('.label_introduce').text(introduce);
        });

        form.on('submit(component-form-element2)', function(data){
            // JSON.stringify()
            // console.log(data.field);return false;
            $.ajax({
                url:"/?s=index/quote_info",
                method:'post',
                data:data.field,
                dataType:'JSON',
                success:function(res){
                    layer.msg(res.msg,{time:2000}, function () {
                        if(res.code == 0)
                        {
                            window.location.href="/?s=index/quote_list";
                        }else if(res.code == -1){
                            layer.open({
                                type: 2,
                                title: '请先登录',
                                shadeClose: true,
                                shade: 0.3,
                                area: ['85%', '50%'],
                                content: "/?s=index/customer_login&open=3",
                            });
                        }
                    });
                },
                error:function (data) {
                    layer.msg('系统错误',{time:2000});
                }
            });
            return false;
        });
        
        form.on('submit(component-form-element3)', function(data){
            $.ajax({
                url:"/?s=index/quote_info",
                method:'post',
                data:{'id':"{$id}",'check':1},
                dataType:'JSON',
                success:function(res){
                    layer.msg(res.msg,{time:2000}, function () {
                        if(res.code == 0)
                        {
                            //跳转到相应业务管理系统
                            window.location.reload();
                        }else if(res.code == -1){
                            layer.open({
                                type: 2,
                                title: '商户实名认证',
                                shadeClose: true,
                                shade: 0.3,
                                area: ['100%', '100%'],
                                content: "/?s=index/merchant_reg&open=1",
                            });
                        }else if(res.code==-2){
                            
                        }
                    });
                },
                error:function (data) {
                    layer.msg('系统错误',{time:2000});
                }
            });
            return false;
        });

        //项目类型1
        form.on('select(project_type)',function(data){
            let val = data.value;
            if(val==1){
                $(this).parent().parent().parent().parent().parent().parent().find('.template_type2').hide();
                $(this).parent().parent().parent().parent().parent().parent().find('.template_type1').show();
            }else if(val==2){
                $(this).parent().parent().parent().parent().parent().parent().find('.template_type2').show();
                $(this).parent().parent().parent().parent().parent().parent().find('.template_type1').hide();
            }
        });
        //计价单位2
        form.on('select(unit_type)',function(data){
            let val = data.value;
            if(val==1){
                $(this).parent().parent().parent().parent().find('.unit').show();
                $(this).parent().parent().parent().parent().find('#unit_name').hide();
            }else if(val==2){
                $(this).parent().parent().parent().parent().find('.unit').hide();
                $(this).parent().parent().parent().parent().find('#unit_name').show();
            }
            form.render(null, 'component-form-element');
        });
        //报价说明3
        form.on('select(quote_type)',function(data){
            let val = data.value;
            let t = this;
            if(val==1){
                $(t).parent().parent().parent().parent().find('.remark').show();
                $(t).parent().parent().parent().parent().find('.date_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.country_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.value_type').hide();
                $(t).parent().parent().parent().parent().find('.range_type').hide();
            }else if(val==2){
                $(t).parent().parent().parent().parent().find('.remark').hide();
                $(t).parent().parent().parent().parent().find('.date_type').show();
                $(t).parent().parent().parent().parent().parent().find('.country_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.value_type').hide();
                $(t).parent().parent().parent().parent().find('.range_type').hide();
            }else if(val==3){
                $(t).parent().parent().parent().parent().find('.remark').hide();
                $(t).parent().parent().parent().parent().find('.date_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.country_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.value_type').hide();
                $(t).parent().parent().parent().parent().find('.range_type').show();
            }
        });
        //适用范围4
        form.on('select(range_type)',function(data){
            let val = data.value;
            let t = this;
            if(val==1){
                $(t).parent().parent().parent().parent().find('.remark').hide();
                $(t).parent().parent().parent().parent().find('.date_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.country_type').show();
                $(t).parent().parent().parent().parent().parent().find('.value_type').hide();
            }else if(val==2){
                $(t).parent().parent().parent().parent().find('.remark').hide();
                $(t).parent().parent().parent().parent().find('.date_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.country_type').hide();
                $(t).parent().parent().parent().parent().parent().find('.value_type').show();
            }
            if(IsPhone()){
                $('.baojia').css('display','contents');
            }else{
                if($(t).parent().parent().parent().parent()[0].attributes[0].value == "disf"){
                    //删除父类保留子类
                    $(t).parent().parent().parent().parent().children().unwrap();
                }
            }
        });
        //适用国地5
        form.on('select(country_type)',function(data){
            let val = data.value;
            if(val==1){
                $(this).parent().parent().parent().parent().find('.country').show();
                $(this).parent().parent().parent().parent().find('#country_name').hide();
            }else if(val==2){
                $(this).parent().parent().parent().parent().find('.country').hide();
                $(this).parent().parent().parent().parent().find('#country_name').show();
            }
            form.render(null, 'component-form-element');
        });
        //适用货物6
        form.on('select(value_type)',function(data){
            let val = data.value;
            if(val==1){
                $(this).parent().parent().parent().parent().find('.value').show();
                $(this).parent().parent().parent().parent().find('#value_name').hide();
            }else if(val==2){
                $(this).parent().parent().parent().parent().find('.value').hide();
                $(this).parent().parent().parent().parent().find('#value_name').show();
            }
            form.render(null, 'component-form-element');
        });
        //收费说明7
        form.on('select(feedesc_type)',function(data){
            let val = data.value;

            if(val==1){
                $(this).parent().parent().parent().parent().find('.quote_type1').show();
                $(this).parent().parent().parent().parent().find('.quote_type2').hide();
            }else if(val==2){
                $(this).parent().parent().parent().parent().find('.quote_type1').hide();
                $(this).parent().parent().parent().parent().find('.quote_type2').show();
            }
        });
        //选择文本
        form.on('select(quote_text)',function(data){
            let val = data.value;
            let t = this;
            $.ajax({
                url: "/?s=index/get_quotetext",
                method: 'post',
                data: {'id':val},
                dataType: 'JSON',
                success: function (res) {
                    $(t).parent().parent().parent().find('.this_textarea').find('.quote_text').text(res.data.text);
                    select_quote = layer.open({
                        type: 1,
                        title: '查看说明文本',
                        shadeClose: true,
                        shade: 0.3,
                        area: ['80%', '80%'],
                        content: $(t).parent().parent().parent().find('.this_textarea'),
                    });
                }
            });
        });
        //有效期限
        laydate.render({
            elem: '#date0' //指定元素
        });
        form.on('select(date_type)',function(data){
            let val = data.value;
            let timee = new Date().getTime();
            let now_num = $(this).parent().parent().parent().find('.now_num').val();
            let html = '<input type="hidden" name="date_num['+now_num+']" id="date_num" value="'+timee+'">\n' +
                '<input type="text" name="date['+now_num+']" class="layui-input" id="date'+timee+'" placeholder="选择日期" value="" autocomplete="off"/>';
            if(val==1){
                // $('.date_box').html(html);
                $(this).parent().parent().parent().parent().find('.date_box').html(html);
                laydate.render({
                    elem: '#date'+timee //指定元素
                });
            }else if(val==2){
                // $('.date_box').html(html);
                $(this).parent().parent().parent().parent().find('.date_box').html(html);
                laydate.render({
                    elem: '#date'+timee //指定元素
                    ,range:true
                    ,min: "<?php echo date('Y-m-d');?>"
                    ,max: "<?php echo date('Y-m-d',time()+63072000)?>"
                });
                if(IsPhone()) {
                    $("#date"+timee).click(function () {
                        setTimeout(function () {
                            $('.layui-laydate-range').css('width', '100%');
                        }, 500);
                    });
                }
            }
            form.render(null,'component-form-element');
        });
    });

    //删除其中一个收费项目
    function del(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form;
        $(t).parent().parent().remove();
        // num-=1;
        form.render(null,'component-form-element');
        layer.msg('删除成功', {
            icon: 6,
        });
    }
    //添加收费文本
    function add_text(text_num,t,typ){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;

        let html = '';
        if(typ==1){
            //说明文本
            html += '                                                       <div class="marbtm10 disf">\n' +
                '                                                                <div class="layui-btn layui-btn-md layui-btn-danger f22" onclick="del_text(this)">-</div>\n' +
                '                                                                <div class="layui-input input20 fake_input" onclick="open_textarea(this)">请输入文本</div>\n' +
                '                                                                <div class="this_textarea">\n' +
                '                                                                    <textarea name="quote_text1['+text_num+'][]" id="quote_text" class="layui-textarea" style="height:500px;" placeholder="请输入文本"></textarea>\n' +
                '                                                                    <div class="layui-btn layui-btn-md layui-btn-normal" onclick="sure_this(this)">确认</div>\n' +
                '                                                                </div>\n' +
                '                                                                <div class="layui-btn layui-btn-md layui-btn-success f22" onclick="add_text('+text_num+',this,1)">+</div>\n' +
                '                                                            </div>';
        }else if(typ==2){
            //选择文本
            html += '                                                     <div class="marbtm10 disf">\n' +
                '                                                                <div class="layui-btn layui-btn-md layui-btn-danger f22" onclick="del_text(this)">-</div>\n' +
                '                                                                <div class="input20">\n' +
                '                                                                    <select name="quote_text2['+text_num+'][]" id="quote_text" class="quote_select" lay-search lay-filter="quote_text">\n';
            {volist name="quote_text" id="vo"}
            html += '                                                                    <option value="{$vo.id}">{$vo.text}</option>\n';
            {/volist}
            html += '                                                            </select>\n' +
                '                                                                    <div class="this_textarea">\n' +
                '                                                                        <textarea name="quote_text2_edit['+text_num+'][]" id="quote_text" class="layui-textarea quote_text" style="height:500px;" placeholder="请输入文本"></textarea>\n' +
                '                                                                        <div class="layui-btn layui-btn-md layui-btn-normal" onclick="sure_this2(this)">无需修改</div>\n' +
                '                                                                        <div class="layui-btn layui-btn-md layui-btn-primary" onclick="sure_this3(this)">确认修改</div>\n' +
                '                                                                    </div>\n' +
                '                                                                </div>\n' +
                '                                                                <div class="layui-btn layui-btn-md layui-btn-success f22" onclick="add_text('+text_num+',this,2)">+</div>\n' +
                '                                                            </div>';
        }
        $(t).parent().parent().append(html);
        form.render(null,'component-form-element');
    }
    //删除收费文本
    function del_text(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;
        $(t).parent().remove();
    }
    //修改收费文本(废弃)
    function edit_text(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;
        let val = $(t).parent().find('select').find('option:selected').text();
        $(t).parent().find('select').remove();
        $(t).parent().find('.layui-form-select').before('<input type="text" class="layui-input" name="quote_text" id="quote_text" value="'+val+'">');
        $(t).parent().find('.layui-form-select').remove();
        $(t).parent().find('.edit_text').remove();
        $(t).parent().find('#quote_text').focus();
    }
    //打开textarea框进行修改
    var window_layer = '';
    function open_textarea(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;
        window_layer = layer.open({
            type: 1,
            title: '填写说明文本',
            shadeClose: true,
            shade: 0.3,
            area: ['80%', '80%'],
            content: $(t).parent().find('.this_textarea'),
        });
    }
    //说明文本-确认填写
    function sure_this(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;
        let val = $(t).parent().find('textarea').val();
        $(t).parent().parent().parent().parent().find('.fake_input').text(val);
        layer.close(window_layer);
    }
    //说明文本-无需修改
    function sure_this2(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;
        let val = $(t).parent().find('textarea').val();

        layer.close(select_quote);
    }
    //说明文本-确认修改
    function sure_this3(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;
        let val = $(t).parent().find('textarea').val();
        $.ajax({
            url: "/?s=index/save_quotetext",
            method: 'post',
            data: {'val':val},
            dataType: 'JSON',
            success: function (res) {
                layer.msg(res.msg,{time:3000}, function () {
                    if (res.code == 0) {
                        //修改成功
                        let html = '';
                        $.each(res.new_select,function(index,item){
                            if(item.id==res.id){
                                html+='<option value="'+item.id+'" selected>'+item.text+'</option>';
                            }else{
                                html+='<option value="'+item.id+'">'+item.text+'</option>';
                            }
                        });
                        $(t).parent().parent().parent().parent().find('.quote_select').html(html);
                        //重新渲染select标签中的内容
                        form.render("select");
                        form.render(null,"component-form-element");
                        layer.close(select_quote);
                    }else if(res.code == -1){

                    }
                });
            }
        });
    }

    function chat(project_name,project_randname,refresh=0){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form
            , laydate = layui.laydate;

        let html = '';
        let who_send=2;//不是单向时，2代表C/B端
        let who_send2=1;//不是单向时，1代表O端
        if("{$data['mid']}">0){
            who_send=2;
            who_send2=1;
        }
        $.ajax({
            url: "/?s=index/quote_chat",
            method: 'post',
            data: {"id":"{$quote_info['id']}",'project_randname':project_randname,'pa':1},
            dataType: 'JSON',
            success: function (res) {
                // $('.chatBox_con').find('.consult_name').text(project_name);
                $('.chatBox_con').find('#quote_id').val(res.id);
                $('.chatBox_con').find('#project_randname').val(res.project_randname);

                if(res.data.length>0){
                    for(let i=0;i<res.data.length;i++){
                        html += '             <div class="center">'+res.data[i].time+'</div>\n';
                        for(let i2=0;i2<res.data[i].info.length;i2++) {
                            if (res.data[i].info[i2]['who_send'] == who_send) {
                                html += '                <div class="conatact_info layui-col-xs12">\n' +
                                    '                            <div class="right disflex">\n' +
                                    '                                <div class="my_txt">\n';
                                // if(res.data[i].info[i2]['content_type']==1){
                                html += res.data[i].info[i2]['content'];
                                // }
                                html += '                            <div class="disf time_info">\n' +
                                    '                                        <div class="time">' + res.data[i].info[i2]['createtime'] + '</div>\n' +
                                    '                                        <div class="status disf">\n';
                                if (res.data[i].info[i2]['is_send'] == 1) {
                                    html += '                               <div class="check-style-unequal-width" style="margin-right:3px;"></div>\n';
                                } else if (res.data[i].info[i2]['is_send'] == 0) {
                                    html += '                               <div class="check-style-unequal-width-1" style="margin-right:3px;"></div>\n';
                                }
                                if (res.data[i].info[i2]['is_read'] == 0) {
                                    html += '                               <div class="check-style-unequal-width2-1" style="margin-right:3px;"></div>\n';
                                } else if (res.data[i].info[i2]['is_read'] == 1) {
                                    html += '                               <div class="check-style-unequal-width2" style="margin-right:3px;"></div>\n';
                                }
                                html += '                                 </div>\n' +
                                    '                                    </div>\n' +
                                    '                                </div>\n' +
                                    '                            </div>\n' +
                                    '                        </div>\n';
                            } else if (res.data[i].info[i2]['who_send'] == who_send2) {
                                html += '                       <div class="conatact_info layui-col-xs12">\n' +
                                    '                            <div class="left disflex">\n' +
                                    '                                <div class="my_txt">' + res.data[i].info[i2]['content'] + '\n'+
                                    '                                    <div class="disf time_info">\n' +
                                    '                                        <div class="time">' + res.data[i].info[i2]['createtime'] + '</div>\n' +
                                    '                                    </div>\n' +
                                    '                                </div>\n' +
                                    '                            </div>\n' +
                                    '                        </div>\n';
                            }
                        }
                    }
                }else{
                    $('.chat_content').html('');
                }
                if(html != ''){
                    $('.chat_content').html(html);
                }
                if(refresh==0) {
                    layer.open({
                        type: 1,
                        title: '咨询项目[' + project_name + ']',
                        area: ['100%', '100%'],
                        content: $('.chatBox_con'),
                        cancel:function(){
                            $('.chatBox_con').hide();
                        }
                    });
                }
                form.on(null,'component-form-group');
            }
        });
        // console.log(idx,template_name);
    }

    function add_template(){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form;
        layer.open({
            type: 2,
            title: '添加模板',
            shadeClose: true,
            shade: 0.3,
            area: ['100%', '100%'],
            content: "/?s=index/save_template&buss_pid={$data['buss_pid']}&buss_id={$data['buss_id']}&ordersn={$data['ordersn']}",
        });
    }

    function incrementValue(event) {
        event.preventDefault();
        var input = event.target.parentNode.querySelector('input[type="number"]');
        var newValue = parseInt(input.value) + 1;
        input.value = newValue > parseInt(input.max) ? input.value : newValue;
    }

    function decrementValue(event) {
        event.preventDefault();
        var input = event.target.parentNode.querySelector('input[type="number"]');
        var newValue = parseInt(input.value) - 1;
        if(newValue>=0){
            input.value = newValue < parseInt(input.min) ? input.value : newValue;
        }
    }

    function add_label5(t){
        var $ = layui.$
            , layer = layui.layer
            , form = layui.form;
        let tmp_length = $('.tmp').length;
        let tmp_val = $(t).parent().parent().parent().parent().find('.tmp').length;
        let tmp = $(t).parent().parent().parent().parent().find('.tmp');
        let select_arr = [];
        for(let i=0;i<tmp_val;i++){
            select_arr.push(tmp.eq(i).find('option:selected').val());
            if(tmp.eq(i).find('option:selected').val()==''){
                layer.msg('新增内容不能为空');return false;
            }
        }
        if(tmp_val+1 > tmp.eq(0).find('option').length-1){
            layer.msg('无可选数据增加');
            return false;
        }
        let tmp_option = $(t).parent().parent().siblings('.layui-form-label').find('.tmp').find('option').length;
        <?php $select_idx = -1;?>
        let html = '<div class="layui-form-item">\n' +
            '                                                            <div class="layui-form-label" style="color:#000;padding:0;overflow:visible;">\n' +
            '                                                                <select name="label5_select['+tmp_length+']" id="tmp" class="tmp" lay-search lay-filter="tmp" lay-verify="required">\n'+
            '                                                                   <option value="">请选择</option>';
        for(let k=0;k<label5_select.length;k++){
            if(select_arr.indexOf(label5_select[k].label_name) > -1){
                html += '<option value="'+label5_select[k].label_name+'" disabled>'+label5_select[k].label_name+'</option>\n';
            }else{
                html += '<option value="'+label5_select[k].label_name+'" data-introduce="'+label5_select[k].label_introduce+'">'+label5_select[k].label_name+'</option>\n';
            }
        }
        html += '                                                        </select>\n' +
            '                                                            </div>\n' +
            '                                                            <div class="layui-input-block">\n' +
            '                                                                <div class="disf" style="align-items: baseline;">\n' +
            '                                                                    <div class="layui-col-xs12" style="margin-right:5px;">\n' +
            '                                                                        <div class="quantity">\n' +
            '                                                                            <button type="button" class="word_color" onclick="decrementValue(event)">-</button>\n' +
            '                                                                            <input type="number" class="layui-input" name="label5_content['+tmp_length+']" value="0" oninput="if(value>1000)value=1000;if(value.length>4)value=value.slice(0,4);if(value<0)value=0" />\n' +
            '                                                                            <button type="button" class="word_color" onclick="incrementValue(event)">+</button>\n' +
            '                                                                        </div>\n';
        for(let k=0;k<label5_select.length;k++){
            if(<?php echo $select_idx;?> == -1)
            {
                <?php $select_idx = 123;?>
                html += '                                                    <span class="label_introduce" style="font-size: 12px;color: {$website[\'color_word\']};"></span>\n';
            }
        }
        html += '                                                                    </div>\n' +
            '                                                                    <div class="layui-btn layui-btn-md layui-btn-primary" onclick="add_label5(this)">增加</div>\n' +
            '                                                                </div>\n' +
            '                                                            </div>\n' +
            '                                                        </div>';
        //将当前的标签名固定，其它列为disabled
        let val_selected = $(t).parent().parent().siblings('.layui-form-label').find('.tmp').find('option:selected').val();
        let val_options = $(t).parent().parent().siblings('.layui-form-label').find('.tmp').find('option');
        for(let k=0;k<val_options.length;k++){
            if(val_selected!=val_options.eq(k).val()){
                $(t).parent().parent().siblings('.layui-form-label').find('.tmp').find('option').eq(k).attr('disabled','disabled');
            }
        }
        $(t).remove();
        $('.label5').append(html);
        form.render(null, 'component-form-element');
    }

</script>
{include file="common/footer"}